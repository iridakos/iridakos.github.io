<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="ocs-site-verification" content="e5faa08e01247c38aadf1c1737ff8136">
  <meta name="google-site-verification" content="KqOxy0ecDlfNdfO530ZAbtNBedy49hn2KziyqLK0JGo" />

  <title>Creating a bash completion script</title>

  <link href="https://fonts.googleapis.com/css?family=Indie+Flower|Open+Sans:400,600,700&amp;subset=greek" rel="stylesheet">

  <link rel="icon" href="/assets/images/favicon.ico?v=4" type="image/x-icon">
  <link rel="stylesheet" href="/css/main.css?1574670109677145845">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="alternate" type="application/rss+xml" title="iridakos" href="https://iridakos.com/feed.xml">
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="Creating a bash completion script" />
<meta name="author" content="Lazarus Lazaridis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A tutorial for adding tab completion to your scripts using the Bash Programmable Completion functionality." />
<meta property="og:description" content="A tutorial for adding tab completion to your scripts using the Bash Programmable Completion functionality." />
<link rel="canonical" href="https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial" />
<meta property="og:url" content="https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial" />
<meta property="og:site_name" content="iridakos" />
<meta property="og:image" content="https://iridakos.com/assets/images/posts/bash-completion/post-image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-01T02:00:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://iridakos.com/assets/images/posts/bash-completion/post-image.png" />
<meta property="twitter:title" content="Creating a bash completion script" />
<meta name="twitter:site" content="@lazaru_s" />
<meta name="twitter:creator" content="@Lazarus Lazaridis" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://iridakos.com/assets/images/site.png"},"name":"Lazarus Lazaridis"},"author":{"@type":"Person","name":"Lazarus Lazaridis"},"image":"https://iridakos.com/assets/images/posts/bash-completion/post-image.png","description":"A tutorial for adding tab completion to your scripts using the Bash Programmable Completion functionality.","@type":"BlogPosting","url":"https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial","headline":"Creating a bash completion script","dateModified":"2018-03-01T02:00:00+02:00","datePublished":"2018-03-01T02:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
  <script type="text/javascript">
      window.cookieconsent_options = {"message":"This website uses cookies to ensure you get the best experience on the website","dismiss":"Got it!","learnMore":"More info","link":null,"theme":"light-bottom"};
  </script>

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
</head>

  <body>
    <nav class="navbar navbar-expand-lg iridakos-navbar">
  <div class="container-fluid no-gutters">
    

    <a class="navbar-brand " href="/" alt="home">
      <i class="fa fa-home"></i>
      home
    </a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#header-pages" aria-controls="header-pages" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon">
        <i class="fa fa-bars pt-1"></i>
      </span>
    </button>

    <div class="collapse navbar-collapse" id="header-pages">
      <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
        

        <li class="nav-item dropdown active">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            programming
          </a>

          <div class="dropdown-menu" aria-labelledby="more">
            <a class="dropdown-item" href="/programming/">all posts</a>
            <a class="dropdown-item" href="/programming/featured/">featured posts</a>
            <a class="dropdown-item" href="/programming/tutorials/">tutorials</a>
            <a class="dropdown-item" href="/programming/how-to/">how to</a>
            <a class="dropdown-item" href="/programming/code/">code</a>
          </div>
        </li>

        

        <li class="nav-item ">
            <a class="nav-link" href="/cats/" alt="cats">cats</a>
        </li>

        

        <li class="nav-item ">
            <a class="nav-link" href="/painting/" alt="painting">painting</a>
        </li>

        

        <li class="nav-item ">
            <a class="nav-link" href="/tags/" alt="tags">tags</a>
        </li>

        

        <li class="nav-item ">
            <a class="nav-link" href="/about/" alt="about">about me</a>
        </li>
      </ul>

      <ul class="navbar-nav mr-0 mt-2 mt-lg-0">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fa fa-language"></i>
            English
          </a>

          <div class="dropdown-menu" aria-labelledby="more">
            
            <a class="dropdown-item" href="/el/programming/2019/11/13/bash-programmable-completion-tutorial">Ελληνικά</a>
          </div>
        </li>
      </ul>

      <form class="form-inline my-2 my-lg-0" method="get" action="/search">
        <div class="input-group input-group-sm mr-sm-2">
          <input class="form-control" name="query" type="search" placeholder="Search the blog">

          <div class="input-group-append">
            <button class="btn btn-warning" type="submit">
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</nav>

<div class="page-title-container">
  <div class="container-fluid no-gutters">
    <div class="page-title">
      <div class="row align-items-center">
        <div class="col-xs-12 col-md-8 col-lg-9 order-md-first order-last text-center text-md-left">
          <h1>Creating a bash completion script</h1>

            <div class="page-subtitle">
            A tutorial for adding tab completion to your scripts using the Bash Programmable Completion functionality.

            
              <div class="post">
                <div class="post-metadata">
                  <div class="post-date" title="published on">
                    Published on <span class="important">Mar 1, 2018</span>
                  </div>

                  <div class="post-category" title="in category">
                    in category <span class="important">programming</span>
                  </div>
                </div>

                
                
                  <div class="post-tags">
                    <span class="important">tags:</span>
                    
                      <a href="/tags/?tag=bash" class="ga-event-link" data-event-label="bash" data-event-action="click" data-event-category="tags">bash</a> - 
                    
                      <a href="/tags/?tag=linux" class="ga-event-link" data-event-label="linux" data-event-action="click" data-event-category="tags">linux</a> - 
                    
                      <a href="/tags/?tag=programmable-completion" class="ga-event-link" data-event-label="programmable-completion" data-event-action="click" data-event-category="tags">programmable-completion</a> - 
                    
                      <a href="/tags/?tag=opensource" class="ga-event-link" data-event-label="opensource" data-event-action="click" data-event-category="tags">opensource</a> - 
                    
                      <a href="/tags/?tag=tutorial" class="ga-event-link" data-event-label="tutorial" data-event-action="click" data-event-category="tags">tutorial</a> - 
                    
                      <a href="/tags/?tag=how-to" class="ga-event-link" data-event-label="how-to" data-event-action="click" data-event-category="tags">how-to</a> - 
                    
                      <a href="/tags/?tag=featured" class="ga-event-link" data-event-label="featured" data-event-action="click" data-event-category="tags">featured</a>
                    
                  </div>
                

                
                
                
                  <div class="my-3">
                    <small>
                      The article is also available in <a href="/el/programming/2019/11/13/bash-programmable-completion-tutorial">greek</a>.
                    </small>
                  </div>
                
              </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


    <div class="container-fluid no-gutters">
      <div class="row">
        <div class="col-xs-12 col-md-8 col-lg-9 page-content">
          
            <div class="row">
              <div class="col-12">
                <div class="outline mb-5">
                  <p>I recently worked on creating a bash completion script for <a class="ga-event-link" data-event-category="From post to Github" data-event-action="click" data-event-label="goto from Bash completion post" href="https://github.com/iridakos/goto">registering directory aliases and navigating to them with autocomplete in Bash</a> and I found the feature really interesting.</p>

<p><a class="ga-event-link" data-event-category="From post to Github" data-event-action="click" data-event-label="goto from Bash completion post" href="https://github.com/iridakos/goto">
  <img class="no-maximize" src="https://github.com/iridakos/goto/raw/master/doc/goto.gif" />
</a></p>

<p>In this post I will familiarize you with the process of adding bash completion to your scripts.</p>

<h2 id="what-is-bash-completion">What is bash completion?</h2>

<p>Bash completion is a functionality through which bash helps users type their commands faster and easier. It accomplishes that by presenting possible options when users press the <code class="highlighter-rouge">tab</code> key while typing a command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git&lt;tab&gt;&lt;tab&gt;
git                 git-receive-pack    git-upload-archive  
gitk                git-shell           git-upload-pack     
<span class="nv">$ </span>git-s&lt;tab&gt;
<span class="nv">$ </span>git-shell
</code></pre></div></div>

<h3 id="how-it-works">How it works</h3>

<p>The completion script is code that uses the builtin bash command <code class="highlighter-rouge">complete</code> to define <strong>which completion suggestions</strong> can be displayed for a given <strong>executable</strong>. The nature of the completion options vary from simple static to highly sophisticated.</p>

<h3 id="why-bother">Why bother</h3>

<p>It is good to provide such a functionality to users:</p>
<ul>
  <li>to save them from typing text when it can be auto-completed</li>
  <li>to help them know what are the available continuations to their commands</li>
  <li>to prevent errors and improve their experience by hiding or showing options based on what they have already typed</li>
</ul>

<h2 id="hands-on">Hands on</h2>

<p>Here’s what we are going to do in this tutorial.</p>

<p>We will first create a dummy executable script called <code class="highlighter-rouge">dothis</code>. All it does is execute the command which resides on the number, that was passed as an argument, in user’s history. For example, the following command will simply execute the <code class="highlighter-rouge">ls -a</code> command given that it exists in history with number <code class="highlighter-rouge">235</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dothis 235
</code></pre></div></div>

<p>Then we will create a bash completion script that will display commands along with their number from <strong>user’s history</strong> and we will “bind” it to the <code class="highlighter-rouge">dothis</code> executable.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dothis &lt;tab&gt;&lt;tab&gt;
215 <span class="nb">ls
</span>216 <span class="nb">ls</span> <span class="nt">-la</span>
217 <span class="nb">cd</span> ~
218 man <span class="nb">history
</span>219 git status
220 <span class="nb">history</span> | <span class="nb">cut</span> <span class="nt">-c</span> 8-
</code></pre></div></div>

<p><img src="/assets/images/posts/bash-completion/post-image.png" alt="Bash completion image" />
You can see a gif demonstrating the functionality <a href="https://github.com/iridakos/bash-completion-tutorial">at this tutorial’s code repository on GitHub</a>.</p>

<p>Let the show begin.</p>

<h3 id="creating-the-executable-script">Creating the executable script</h3>

<p>Create a file named <code class="highlighter-rouge">dothis</code> in your working directory and add the following code:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"No command number passed"</span>
  <span class="nb">exit </span>2
<span class="k">fi

</span><span class="nv">exists</span><span class="o">=</span><span class="si">$(</span><span class="nb">fc</span> <span class="nt">-l</span> <span class="nt">-1000</span> | <span class="nb">grep</span> ^<span class="nv">$1</span> <span class="nt">--</span> 2&gt;/dev/null<span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$exists</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">fc</span> <span class="nt">-s</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"Command with number </span><span class="nv">$1</span><span class="s2"> was not found in recent history"</span>
  <span class="nb">exit </span>2
<span class="k">fi</span>
</code></pre></div></div>

<p><strong>Notes:</strong></p>
<ul>
  <li>We first check if the script was called with an argument</li>
  <li>We then check if the specific number is included in the last 1000 commands
    <ul>
      <li>if it exists we execute the command using the <code class="highlighter-rouge">fc</code> functionality</li>
      <li>otherwise we display an error message</li>
    </ul>
  </li>
</ul>

<p>Make the script executable with:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x ./dothis
</code></pre></div></div>

<p>We are going to execute this script many times in this tutorial so I suggest you place it in a folder that is included in your <a href="http://www.linfo.org/path_env_var.html">path</a> so that we can access it from anywhere with just typing <code class="highlighter-rouge">dothis</code>.</p>

<p>I installed it in my <strong>home bin</strong> folder using:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">install</span> ./dothis ~/bin/dothis
</code></pre></div></div>

<p>You can do the same given that you have a <code class="highlighter-rouge">~/bin</code> folder and that it is included in your <code class="highlighter-rouge">PATH</code> variable.</p>

<p>Try to see if it’s working:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dothis
</code></pre></div></div>

<p>You should see this.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dothis
No <span class="nb">command </span>number passed
</code></pre></div></div>

<p>Done.</p>

<h3 id="creating-the-completion-script">Creating the completion script</h3>

<p>Create a file named <code class="highlighter-rouge">dothis-completion.bash</code>. From now on we will be referring to this file with the term <strong>completion script</strong>.</p>

<p>Once we add some code to it, we will <code class="highlighter-rouge">source</code> it to allow the completion to take effect.
We must <code class="highlighter-rouge">source</code> this file <strong>every single time we change something in it</strong>.</p>

<p>We will discuss our options for registering this script whenever a bash shell opens <a href="#registering-the-completion-script">later on</a>.</p>

<h4 id="static-completion">Static completion</h4>

<p>Suppose that the <code class="highlighter-rouge">dothis</code> program supported a list of commands, for example:</p>
<ul>
  <li><code class="highlighter-rouge">now</code></li>
  <li><code class="highlighter-rouge">tomorrow</code></li>
  <li><code class="highlighter-rouge">never</code></li>
</ul>

<p>Let’s use the <code class="highlighter-rouge">complete</code> command to register this list for completion. To use the proper terminology, we say we use the <code class="highlighter-rouge">complete</code> command to define a completion specification (<strong>compspec</strong>) for our program.</p>

<p>Add this to the completion script.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#/usr/bin/env bash</span>
<span class="nb">complete</span> <span class="nt">-W</span> <span class="s2">"now tomorrow never"</span> dothis
</code></pre></div></div>

<p>What did we specify with the <code class="highlighter-rouge">complete</code> command above:</p>
<ul>
  <li>we used the <code class="highlighter-rouge">-W</code> (<em>wordlist</em>) option to provide a list of words for completion.</li>
  <li>we defined to which “program” these completion words will be used (the <code class="highlighter-rouge">dothis</code> parameter)</li>
</ul>

<p>Source the file:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ./dothis-completion.bash
</code></pre></div></div>

<p>Now try pressing tab twice in the command line as shown below:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dothis &lt;tab&gt;&lt;tab&gt;
never     now       tomorrow
</code></pre></div></div>

<p>Try again after typing the <code class="highlighter-rouge">n</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dothis n&lt;tab&gt;&lt;tab&gt;
never now
</code></pre></div></div>

<p>Magic! The completion options are automatically filtered to match only those starting with <code class="highlighter-rouge">n</code>.</p>

<p><strong>Note:</strong>
The options are not displayed in the order that we defined them in the word list, they are automatically sorted.</p>

<p>There are a lot of other options to be used instead of the <code class="highlighter-rouge">-W</code> that we used in this section. Most of them produce completions in a fixed manner, meaning that we don’t intervene dynamically to filter their output.</p>

<p>For example, if we wanted to have directory names as completion words for the <code class="highlighter-rouge">dothis</code> program, we would change the complete command to the following:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">complete</span> <span class="nt">-A</span> directory dothis
</code></pre></div></div>
<p>Pressing tab after the <code class="highlighter-rouge">dothis</code> program, we would get a list of the directories in the current directory from which we execute the script:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dothis &lt;tab&gt;&lt;tab&gt;
dir1/ dir2/ dir3/
</code></pre></div></div>

<p>Find the complete list of the available flags <a href="https://www.gnu.org/software/bash/manual/html_node/Programmable-Completion-Builtins.html#Programmable-Completion-Builtins">here</a>.</p>

<h4 id="dynamic-completion">Dynamic completion</h4>

<p>We will be producing the completions of the <code class="highlighter-rouge">dothis</code> executable with the following logic:</p>

<ul>
  <li>If user presses the tab key right after the command, we will show the last 50 executed commands along with their numbers in history</li>
  <li>If user presses the tab key after typing a number that matches more than one commands from history, we will show only those commands along with their numbers in history</li>
  <li>If user presses the tab key after a number that matches exactly one command in history, we auto-complete the number without appending the command’s literal (if it’s confusing, you will better understand later on, no worries)</li>
</ul>

<p>Let’s start by defining a function that will execute each time user requests completion on a <code class="highlighter-rouge">dothis</code> command. Change the completion script to this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#/usr/bin/env bash</span>
_dothis_completions<span class="o">()</span>
<span class="o">{</span>
  COMPREPLY+<span class="o">=(</span><span class="s2">"now"</span><span class="o">)</span>
  COMPREPLY+<span class="o">=(</span><span class="s2">"tomorrow"</span><span class="o">)</span>
  COMPREPLY+<span class="o">=(</span><span class="s2">"never"</span><span class="o">)</span>
<span class="o">}</span>

<span class="nb">complete</span> <span class="nt">-F</span> _dothis_completions dothis
</code></pre></div></div>

<p>Note the following:</p>
<ul>
  <li>we used the <code class="highlighter-rouge">-F</code> flag in the complete command defining that the <code class="highlighter-rouge">_dothis_completions</code> is the function that will provide the completions of the <code class="highlighter-rouge">dothis</code> executable</li>
  <li><code class="highlighter-rouge">COMPREPLY</code> is an array variable used to store the completions - the completion mechanism uses this variable to display its contents as completions</li>
</ul>

<p>Now source the script and go for completion:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dothis &lt;tab&gt;&lt;tab&gt;
never now tomorrow
</code></pre></div></div>

<p>Perfect. We produce the same completions as in the previous section with the word list. Or not? Try this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dothis nev&lt;tab&gt;&lt;tab&gt;
never     now       tomorrow
</code></pre></div></div>
<p>As you can see, even though we type <strong>nev</strong> and then we request for completion, the available options are always the same and nothing gets completed automatically. Why is this happening?</p>
<ul>
  <li>The contents of the <code class="highlighter-rouge">COMPREPLY</code> variable are always displayed. The function is responsible to add/remove entries from there now.</li>
  <li>If the <code class="highlighter-rouge">COMPREPLY</code> variable had only one element then that word would be automatically completed in the command. Since current implementation always return the same three words, this will not happen.</li>
</ul>

<p>Enter <code class="highlighter-rouge">compgen</code>: a builtin command that generates completions supporting most of the options of the <code class="highlighter-rouge">complete</code> command (ex. <code class="highlighter-rouge">-W</code> for word list, <code class="highlighter-rouge">-d</code> for directories) and filtering them based on what already has been typed by the user.</p>

<p>Don’t worry if you feel confused, everything will become clear later on.</p>

<p>Type the following in the console to better understand what compgen does:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">compgen</span> <span class="nt">-W</span> <span class="s2">"now tomorrow never"</span>
now
tomorrow
never
<span class="nv">$ </span><span class="nb">compgen</span> <span class="nt">-W</span> <span class="s2">"now tomorrow never"</span> n
now
never
<span class="nv">$ </span><span class="nb">compgen</span> <span class="nt">-W</span> <span class="s2">"now tomorrow never"</span> t
tomorrow
</code></pre></div></div>

<p>So now we can use it but we need to find a way to know what has been typed after the <code class="highlighter-rouge">dothis</code> command.
We already have the way. The bash completion facilities provide <a href="https://www.gnu.org/software/bash/manual/html_node/Bash-Variables.html#Bash-Variables">bash variables</a> related to the completion taking place. Here are the more important ones:</p>

<ul>
  <li><code class="highlighter-rouge">COMP_WORDS</code>: an array of all the words typed after the name of the program the <code class="highlighter-rouge">compspec</code> belongs to</li>
  <li><code class="highlighter-rouge">COMP_CWORD</code>: an index of the <code class="highlighter-rouge">COMP_WORDS</code> array pointing to the word the current cursor is at - in other words, the index of the word the cursor was when the tab key was pressed</li>
  <li><code class="highlighter-rouge">COMP_LINE</code>: the current command line</li>
</ul>

<p>To access the word just after the <code class="highlighter-rouge">dothis</code> word, we can use the value of <code class="highlighter-rouge">COMP_WORDS[1]</code></p>

<p>Change the completion script again:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#/usr/bin/env bash</span>
_dothis_completions<span class="o">()</span>
<span class="o">{</span>
  <span class="nv">COMPREPLY</span><span class="o">=(</span><span class="si">$(</span><span class="nb">compgen</span> <span class="nt">-W</span> <span class="s2">"now tomorrow never"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">COMP_WORDS</span><span class="p">[1]</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span><span class="o">)</span>
<span class="o">}</span>

<span class="nb">complete</span> <span class="nt">-F</span> _dothis_completions dothis
</code></pre></div></div>
<p>Source and there you are:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>dothis
never     now       tomorrow  
<span class="nv">$ </span>dothis n
never  now
</code></pre></div></div>

<p>Now, instead of the <em>now, tomorrow, never</em> words, we would like to see actual numbers from the command history.</p>

<p>The <code class="highlighter-rouge">fc -l</code> command followed by a negative number <code class="highlighter-rouge">-n</code> displays the last <strong>n</strong> commands.
So, we will use:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">fc</span> <span class="nt">-l</span> <span class="nt">-50</span>
</code></pre></div></div>
<p>which lists the last <strong>50</strong> executed commands along with their numbers. The only manipulation we need to do is replace tabs with spaces in order to be displayed properly from the completion mechanism. <code class="highlighter-rouge">sed</code> to the rescue.</p>

<p>Change the completion script as follows:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#/usr/bin/env bash</span>
_dothis_completions<span class="o">()</span>
<span class="o">{</span>
  <span class="nv">COMPREPLY</span><span class="o">=(</span><span class="si">$(</span><span class="nb">compgen</span> <span class="nt">-W</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">fc</span> <span class="nt">-l</span> <span class="nt">-50</span> | <span class="nb">sed</span> <span class="s1">'s/\t//'</span><span class="si">)</span><span class="s2">"</span> <span class="nt">--</span> <span class="s2">"</span><span class="k">${</span><span class="nv">COMP_WORDS</span><span class="p">[1]</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span><span class="o">)</span>
<span class="o">}</span>

<span class="nb">complete</span> <span class="nt">-F</span> _dothis_completions dothis
</code></pre></div></div>

<p>Source and test in the console:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dothis &lt;tab&gt;&lt;tab&gt;
632 <span class="nb">source </span>dothis-completion.bash   649 <span class="nb">source </span>dothis-completion.bash   666 <span class="nb">cat</span> ~/.bash_profile
633 clear                           650 clear                           667 <span class="nb">cat</span> ~/.bashrc
634 <span class="nb">source </span>dothis-completion.bash   651 <span class="nb">source </span>dothis-completion.bash   668 clear
635 <span class="nb">source </span>dothis-completion.bash   652 <span class="nb">source </span>dothis-completion.bash   669 <span class="nb">install</span> ./dothis ~/bin/dothis
636 clear                           653 <span class="nb">source </span>dothis-completion.bash   670 dothis
637 <span class="nb">source </span>dothis-completion.bash   654 clear                           671 dothis 6546545646
638 clear                           655 dothis 654                      672 clear
639 <span class="nb">source </span>dothis-completion.bash   656 dothis 631                      673 dothis
640 <span class="nb">source </span>dothis-completion.bash   657 dothis 150                      674 dothis 651
641 <span class="nb">source </span>dothis-completion.bash   658 dothis                          675 <span class="nb">source </span>dothis-completion.bash
642 clear                           659 clear                           676 dothis 651
643 dothis 623  <span class="nb">ls</span> <span class="nt">-la</span>              660 dothis                          677 dothis 659
644 clear                           661 <span class="nb">install</span> ./dothis ~/bin/dothis   678 clear
645 <span class="nb">source </span>dothis-completion.bash   662 dothis                          679 dothis 665
646 clear                           663 <span class="nb">install</span> ./dothis ~/bin/dothis   680 clear
647 <span class="nb">source </span>dothis-completion.bash   664 dothis                          681 clear
648 clear                           665 <span class="nb">cat</span> ~/.bashrc
</code></pre></div></div>

<p>Not bad.</p>

<p>We do have a problem though. Try typing a number as you see it in your completion list and the press the <tab> key again.</tab></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dothis 623&lt;tab&gt;
<span class="nv">$ </span>dothis 623  <span class="nb">ls </span>623  <span class="nb">ls</span> <span class="nt">-la</span>
...
<span class="nv">$ </span>dothis 623  <span class="nb">ls </span>623  <span class="nb">ls </span>623  <span class="nb">ls </span>623  <span class="nb">ls </span>623  <span class="nb">ls</span> <span class="nt">-la</span>
</code></pre></div></div>

<p>This is happening because in our completion script, we used the <code class="highlighter-rouge">${COMP_WORDS[1]}</code> to always check the first typed word after the <code class="highlighter-rouge">dothis</code> command (the number <code class="highlighter-rouge">623</code> in the above snippet). Hence the completion continues suggesting the same completion again and again while pressing the tab key.</p>

<p>To fix this, we will not allow any kind of completion to take place if at least one argument has already been typed. We will add a condition in our function checking the size of the aforementioned <code class="highlighter-rouge">COMP_WORDS</code> array.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#/usr/bin/env bash</span>
_dothis_completions<span class="o">()</span>
<span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${#</span><span class="nv">COMP_WORDS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"2"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    return
  fi

  </span><span class="nv">COMPREPLY</span><span class="o">=(</span><span class="si">$(</span><span class="nb">compgen</span> <span class="nt">-W</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">fc</span> <span class="nt">-l</span> <span class="nt">-50</span> | <span class="nb">sed</span> <span class="s1">'s/\t//'</span><span class="si">)</span><span class="s2">"</span> <span class="nt">--</span> <span class="s2">"</span><span class="k">${</span><span class="nv">COMP_WORDS</span><span class="p">[1]</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span><span class="o">)</span>
<span class="o">}</span>

<span class="nb">complete</span> <span class="nt">-F</span> _dothis_completions dothis
</code></pre></div></div>

<p>Source and retry.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dothis 623&lt;tab&gt;
<span class="nv">$ </span>dothis 623 <span class="nb">ls</span> <span class="nt">-la</span>&lt;tab&gt; <span class="c"># SUCCESS: nothing happens here</span>
</code></pre></div></div>

<p>There is another thing we don’t like though. We do want to display the numbers along with the corresponding commands to help users decide which one is the desired but when there is only one completion suggestion and gets automatically picked by the completion mechanism, <strong>we shouldn’t append the command literal too</strong>.</p>

<p>In other words, our <code class="highlighter-rouge">dothis</code> executable accepts only a number and we haven’t added any functionality checking or expecting other arguments. When our completion function gives only one result, we should trim the command literal and respond only with the command number.</p>

<p>To accomplish this, we will keep the response of the <code class="highlighter-rouge">compgen</code> command in an array variable and if its size is <strong>1</strong> we will trim the one and only element to keep just the number. Otherwise, we’ll let the array as is.</p>

<p>Change the completion script to this:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#/usr/bin/env bash</span>
_dothis_completions<span class="o">()</span>
<span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${#</span><span class="nv">COMP_WORDS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"2"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    return
  fi</span>

  <span class="c"># keep the suggestions in a local variable</span>
  <span class="nb">local </span><span class="nv">suggestions</span><span class="o">=(</span><span class="si">$(</span><span class="nb">compgen</span> <span class="nt">-W</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">fc</span> <span class="nt">-l</span> <span class="nt">-50</span> | <span class="nb">sed</span> <span class="s1">'s/\t/ /'</span><span class="si">)</span><span class="s2">"</span> <span class="nt">--</span> <span class="s2">"</span><span class="k">${</span><span class="nv">COMP_WORDS</span><span class="p">[1]</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span><span class="o">)</span>

  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${#</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"1"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c"># if there's only one match, we remove the command literal</span>
    <span class="c"># to proceed with the automatic completion of the number</span>
    <span class="nb">local </span><span class="nv">number</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">suggestions</span><span class="p">[0]/%\ */</span><span class="k">}</span><span class="si">)</span>
    <span class="nv">COMPREPLY</span><span class="o">=(</span><span class="s2">"</span><span class="nv">$number</span><span class="s2">"</span><span class="o">)</span>
  <span class="k">else</span>
    <span class="c"># more than one suggestions resolved,</span>
    <span class="c"># respond with the suggestions intact</span>
    <span class="nv">COMPREPLY</span><span class="o">=(</span><span class="s2">"</span><span class="k">${</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="o">)</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="nb">complete</span> <span class="nt">-F</span> _dothis_completions dothis
</code></pre></div></div>

<h3 id="registering-the-completion-script">Registering the completion script</h3>

<p>If you want to enable the completion just for you on your machine, all you have to do is add a line in your <code class="highlighter-rouge">.bashrc</code> file sourcing the script:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> &lt;path-to-your-script&gt;/dothis-completion.bash
</code></pre></div></div>

<p>If you want to enable the completion for all users, you can just copy the script under <code class="highlighter-rouge">/etc/bash_completion.d/</code> and it will automatically be loaded by Bash.</p>

<h3 id="fine-tuning-the-completion-script">Fine tuning the completion script</h3>

<p>Some extra steps for better results :)</p>

<h4 id="displaying-each-entry-in-a-new-line">Displaying each entry in a new line</h4>

<p>Well, in the bash completion script I was working on, I too had to present suggestions consisting of two parts. I wanted to display the first part with the default color and the second part with a gray color to point out that it was just help text. In this tutorial’s example, it would be nice to present the numbers in the default color but the command literal in another one, less fancy.</p>

<p>Unfortunately, this is not possible at least for the time being because the completions are displayed as plain text and color directives are not processed (for example: <code class="highlighter-rouge">\e[34mBlue</code>).</p>

<p>What we can do though to improve user experience (or not :D) is to display each entry in a new line. This solution is not that obvious since again we can’t just append a new line character in each <code class="highlighter-rouge">COMPREPLY</code> entry. We will follow a rather <a href="https://unix.stackexchange.com/questions/166908/is-there-anyway-to-get-compreply-to-be-output-as-a-vertical-list-of-words-instea">hackish</a> way and pad suggestion literals to such a width that fills the terminal’s width.</p>

<p>Enter <code class="highlighter-rouge">printf</code>. If you want to display each suggestion on each own line, change the completion script to the following:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#/usr/bin/env bash</span>
_dothis_completions<span class="o">()</span>
<span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${#</span><span class="nv">COMP_WORDS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"2"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    return
  fi

  </span><span class="nb">local </span><span class="nv">IFS</span><span class="o">=</span><span class="s1">$'</span><span class="se">\n</span><span class="s1">'</span>
  <span class="nb">local </span><span class="nv">suggestions</span><span class="o">=(</span><span class="si">$(</span><span class="nb">compgen</span> <span class="nt">-W</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">fc</span> <span class="nt">-l</span> <span class="nt">-50</span> | <span class="nb">sed</span> <span class="s1">'s/\t//'</span><span class="si">)</span><span class="s2">"</span> <span class="nt">--</span> <span class="s2">"</span><span class="k">${</span><span class="nv">COMP_WORDS</span><span class="p">[1]</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span><span class="o">)</span>

  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${#</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"1"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">local </span><span class="nv">number</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">suggestions</span><span class="p">[0]/%\ */</span><span class="k">}</span><span class="s2">"</span>
    <span class="nv">COMPREPLY</span><span class="o">=(</span><span class="s2">"</span><span class="nv">$number</span><span class="s2">"</span><span class="o">)</span>
  <span class="k">else
    for </span>i <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="p">!suggestions[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
      </span>suggestions[<span class="nv">$i</span><span class="o">]=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'%*s'</span> <span class="s2">"-</span><span class="nv">$COLUMNS</span><span class="s2">"</span>  <span class="s2">"</span><span class="k">${</span><span class="nv">suggestions</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
    <span class="k">done

    </span><span class="nv">COMPREPLY</span><span class="o">=(</span><span class="s2">"</span><span class="k">${</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="o">)</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="nb">complete</span> <span class="nt">-F</span> _dothis_completions dothis
</code></pre></div></div>

<p>Source and test:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dothis &lt;tab&gt;&lt;tab&gt;
...
499 <span class="nb">source </span>dothis-completion.bash                   
500 clear
...       
503 dothis 500
</code></pre></div></div>

<h4 id="customizable-behavior">Customizable behavior</h4>

<p>In our case, we hard-coded to display the last 50 commands for completion. This is not a good practice. We should first respect what each user might prefer and if he/she hasn’t made any preference then we should default to 50.</p>

<p>To accomplish that we will check if an environment variable <code class="highlighter-rouge">DOTHIS_COMPLETION_COMMANDS_NUMBER</code> has been set.</p>

<p>Change the completion script one last time:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#/usr/bin/env bash</span>
_dothis_completions<span class="o">()</span>
<span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${#</span><span class="nv">COMP_WORDS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"2"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    return
  fi

  </span><span class="nb">local </span><span class="nv">commands_number</span><span class="o">=</span><span class="k">${</span><span class="nv">DOTHIS_COMPLETION_COMMANDS_NUMBER</span><span class="k">:-</span><span class="nv">50</span><span class="k">}</span>
  <span class="nb">local </span><span class="nv">IFS</span><span class="o">=</span><span class="s1">$'</span><span class="se">\n</span><span class="s1">'</span>
  <span class="nb">local </span><span class="nv">suggestions</span><span class="o">=(</span><span class="si">$(</span><span class="nb">compgen</span> <span class="nt">-W</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">fc</span> <span class="nt">-l</span> -<span class="nv">$commands_number</span> | <span class="nb">sed</span> <span class="s1">'s/\t//'</span><span class="si">)</span><span class="s2">"</span> <span class="nt">--</span> <span class="s2">"</span><span class="k">${</span><span class="nv">COMP_WORDS</span><span class="p">[1]</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span><span class="o">)</span>

  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${#</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"1"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">local </span><span class="nv">number</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">suggestions</span><span class="p">[0]/%\ */</span><span class="k">}</span><span class="s2">"</span>
    <span class="nv">COMPREPLY</span><span class="o">=(</span><span class="s2">"</span><span class="nv">$number</span><span class="s2">"</span><span class="o">)</span>
  <span class="k">else
    for </span>i <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="p">!suggestions[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
      </span>suggestions[<span class="nv">$i</span><span class="o">]=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'%*s'</span> <span class="s2">"-</span><span class="nv">$COLUMNS</span><span class="s2">"</span>  <span class="s2">"</span><span class="k">${</span><span class="nv">suggestions</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
    <span class="k">done

    </span><span class="nv">COMPREPLY</span><span class="o">=(</span><span class="s2">"</span><span class="k">${</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="o">)</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="nb">complete</span> <span class="nt">-F</span> _dothis_completions dothis
</code></pre></div></div>

<p>Source and test:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">DOTHIS_COMPLETION_COMMANDS_NUMBER</span><span class="o">=</span>5
<span class="nv">$ </span>dothis &lt;tab&gt;&lt;tab&gt;
505 clear
506 <span class="nb">source</span> ./dothis-completion.bash
507 dothis clear
508 clear
509 <span class="nb">export </span><span class="nv">DOTHIS_COMPLETION_COMMANDS_NUMBER</span><span class="o">=</span>5
</code></pre></div></div>

<h2 id="useful-links">Useful links</h2>

<ul>
  <li><a href="https://github.com/git/git/blob/master/contrib/completion/git-completion.bash">Git’s completion script</a></li>
  <li><a href="https://github.com/iridakos/goto/blob/master/goto.sh">Bash completion for <code class="highlighter-rouge">goto</code>, one of my shell scripts</a></li>
  <li><a href="https://www.gnu.org/software/bash/manual/html_node/Programmable-Completion.html#Programmable-Completion">Bash Reference Manual: Programmable Completion</a></li>
  <li><a href="https://www.gnu.org/software/bash/manual/html_node/Programmable-Completion-Builtins.html#Programmable-Completion-Builtins">Bash Reference Manual: Programmable Completion Builtins</a></li>
  <li><a href="https://www.gnu.org/software/bash/manual/html_node/A-Programmable-Completion-Example.html#A-Programmable-Completion-Example">Bash Reference Manual: A Programmable Completion Example</a></li>
  <li><a href="https://www.gnu.org/software/bash/manual/html_node/Bash-Variables.html#Bash-Variables">Bash Reference Manual: Bash Variables</a></li>
</ul>

<h2 id="code-and-comments">Code and Comments</h2>

<p>You can find the <strong>code of this tutorial</strong> on <a href="https://github.com/iridakos/bash-completion-tutorial">GitHub</a>.</p>

<p>For <strong>feedback, comments, typos etc</strong>. please open an <a href="https://github.com/iridakos/bash-completion-tutorial/issues">issue</a> in the repository.</p>

<h3 id="long-post-cat-photo">Long post, cat photo</h3>

<p>Let me introduce you to my debugger.</p>

<p><img src="/assets/images/posts/bash-completion/cat.jpg" alt="My debugger" /></p>

<p>That’s all folks!</p>

                </div>
              </div>

              <div class="col-12 order-first">
                <div class="d-sm-block d-md-none mb-3">
                  <a class="ga-event-link btn btn-outline-primary d-block collapsed text-left"
                    data-event-label="Creating a bash completion script"
                    data-event-category="Document outline"
                    data-event-action="click"
                    title="View the structure of this document"
                    role="button"
                    data-toggle="collapse"
                    data-role="outline"
                    data-content=".outline"
                    href="#docout-mobile"
                    data-target="#docout-mobile"
                    aria-expanded="false"
                    aria-controls="collapse">
                    Table of contents
                    <i class="fa iridakos-collapse pull-right mt-1"></i>
                  </a>

                  <div id="docout-mobile" class="collapse my-3 border rounded bg-light p-2">
                  </div>
                </div>
              </div>
            </div>
          

          


  
    <div class="alert alert-light related-posts">
      <h4 class="alert-heading text-dark"><i class="fa fa-hand-spock-o" aria-hidden="true"></i> My latest post</h4>

      <div class="row mt-3">
        <div class="col">
          <a class="alert-link ga-event-link"
             data-event-category="Latest post"
             data-event-action="click"
             data-event-label="i"
             href="/programming/2019/11/22/i"><strong>i</strong></a>
          <div>
            <small>A poem for var i</small>
          </div>
        </div>
      </div>
    </div>
  


          
<div class="alert alert-light related-posts">
  <h4 class="alert-heading text-dark"><i class="fa fa-hand-o-right" aria-hidden="true"></i> Related posts</h4>

  

  <ul class="list-unstyled">
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <li>
          <a class="alert-link ga-event-link"
             data-event-category="Related posts"
             data-event-action="click"
             data-event-label="How to remove duplicate lines from files preserving their order"
             href="/programming/2019/05/16/remove-duplicate-lines-preserving-order-linux"><strong>How to remove duplicate lines from files preserving their order</strong></a>
          <div>
            <small>How to remove duplicate lines of a file in Linux without sorting or changing their order (awk one-liner explained).</small>
          </div>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <li>
          <a class="alert-link ga-event-link"
             data-event-category="Related posts"
             data-event-action="click"
             data-event-label="How to alias and navigate to directories with autocomplete in Linux"
             href="/programming/2019/04/10/shell-navigation-with-autocomplete"><strong>How to alias and navigate to directories with autocomplete in Linux</strong></a>
          <div>
            <small>A Linux shell script for registering directory aliases and navigating to them with tab completion.</small>
          </div>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <li>
          <a class="alert-link ga-event-link"
             data-event-category="Related posts"
             data-event-action="click"
             data-event-label="Creating a Linux Desktop application with Ruby"
             href="/programming/2018/01/25/creating-a-gtk-todo-application-with-ruby"><strong>Creating a Linux Desktop application with Ruby</strong></a>
          <div>
            <small>A tutorial for creating a simple GTK ToDo application with Ruby</small>
          </div>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
  </ul>
</div>



          <div class="alert alert-light">
            <h4>
              <i class="fa fa-share-alt"></i>
              Share
            </h4>
            
<div class="share-links">
  <a class="btn btn-warning ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Share to Twitter" data-event-action="click" href="https://twitter.com/intent/tweet?text=Creating a bash completion script&url=https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter"></i></a>
  <a class="btn btn-warning ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Share to Facebook" data-event-action="click" href="https://facebook.com/sharer.php?u=https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook"></i></a>
  <a class="btn btn-warning ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Share to Reddit" data-event-action="click" href="https://www.reddit.com/submit" onclick="window.location = 'https://www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false" title="Share on Reddit"><i class="fa fa-reddit"></i></a>
  <a class="btn btn-warning ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Share with email" data-event-action="click" href="mailto:?subject=Creating a bash completion script&amp;body=Creating a bash completion script: https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial"><i class="fa fa-envelope-o" title="Share with email"></i></a>
</div>

<div class="subscribe-links">
  <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <i class="fa fa-rss"></i> Subscribe via RSS
  </button>

  <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to all posts RSS" data-event-action="click" href="/feed.xml">all posts</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to programming posts RSS" data-event-action="click" href="/feeds/programming.xml">all programming related posts</a>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to tutorial posts RSS" data-event-action="click" href="/feeds/tutorials.xml">programming tutorials posts</a>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to opensource posts RSS" data-event-action="click" href="/feeds/opensource.xml">opensource related posts</a>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to ruby posts RSS" data-event-action="click" href="/feeds/ruby.xml">ruby and rails related posts</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to painting posts RSS" data-event-action="click" href="/feeds/painting.xml">painting posts</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to cat photo posts RSS" data-event-action="click" href="/feeds/cats.xml">cat photos</a>
  </div>
</div>

          </div>


        </div>

        <div class="col">
          <div class="sidebar">
  
    <div class="alert alert-primary d-none d-md-block">
      <div class="sidebar-section">
        <a class="ga-event-link btn btn-warning d-block collapsed text-left"
          data-event-label="Creating a bash completion script"
          data-event-category="Document outline"
          data-event-action="click"

          data-toggle="collapse"
          data-role="outline"
          data-content=".outline"
          href="#docout-sidebar"
          data-target="#docout-sidebar"

          title="View the structure of this document"
          role="button"
          href="#docout-sidebar"
          aria-expanded="false"
          aria-controls="collapse">
          Table of contents
          <i class="fa iridakos-collapse pull-right mt-1"></i>
        </a>

        <div class="section-content">
          <div id="docout-sidebar" class="collapse mt-2 p-2">

          </div>
        </div>
      </div>
    </div>
  

  

  <div class="alert alert-primary">
  <div class="sidebar-section">
    <div class="section-title">
      <h4><i class="fa fa-hand-spock-o"></i> featured posts</h4>
    </div>

    <div class="section-content">
      
      
        
          <div class="section-item">
            <div class="float-right ml-1">
              
                <span class="featured-hacker-news" title="Featured in Hacker News" data-toggle="tooltip"><i class="fa fa-hacker-news"></i></span>
              
                <span class="featured-opensource-com" title="Featured in opensource.com" data-toggle="tooltip"><i class="fa fa-linux"></i></span>
              
                <span class="featured-hackernewsletter" title="Featured in hackernewsletter" data-toggle="tooltip"><i class="fa fa-envelope"></i></span>
              
            </div>
            <a href="/programming/2018/03/01/bash-programmable-completion-tutorial"
               class="ga-event-link"
               data-event-category="Featured posts"
               data-event-action="click"
               data-event-label="Creating a bash completion script">Creating a bash completion script</a>
             <div class="text-muted smaller">
               A tutorial for adding tab completion to your scripts using the Bash Programmable Completion functionality.
             </div>
          </div>
        
      
        
          <div class="section-item">
            <div class="float-right ml-1">
              
                <span class="featured-hacker-news" title="Featured in Hacker News" data-toggle="tooltip"><i class="fa fa-hacker-news"></i></span>
              
                <span class="featured-ruby-weekly" title="Featured in Ruby Weekly" data-toggle="tooltip"><i class="fa fa-diamond"></i></span>
              
                <span class="featured-opensource-com" title="Featured in opensource.com" data-toggle="tooltip"><i class="fa fa-linux"></i></span>
              
            </div>
            <a href="/programming/2018/01/25/creating-a-gtk-todo-application-with-ruby"
               class="ga-event-link"
               data-event-category="Featured posts"
               data-event-action="click"
               data-event-label="Creating a Linux Desktop application with Ruby">Creating a Linux Desktop application with Ruby</a>
             <div class="text-muted smaller">
               A tutorial for creating a simple GTK ToDo application with Ruby
             </div>
          </div>
        
      
        
          <div class="section-item">
            <div class="float-right ml-1">
              
                <span class="featured-hacker-news" title="Featured in Hacker News" data-toggle="tooltip"><i class="fa fa-hacker-news"></i></span>
              
                <span class="featured-betterldevlink" title="Featured in Better Dev Link" data-toggle="tooltip"><i class="fa fa-envelope"></i></span>
              
            </div>
            <a href="/programming/2019/06/26/composing-better-emails"
               class="ga-event-link"
               data-event-category="Featured posts"
               data-event-action="click"
               data-event-label="How to write better emails">How to write better emails</a>
             <div class="text-muted smaller">
               Tips for composing effective emails avoiding misunderstandings with examples from the software development world.
             </div>
          </div>
        
      
        
          <div class="section-item">
            <div class="float-right ml-1">
              
                <span class="featured-hacker-news" title="Featured in Hacker News" data-toggle="tooltip"><i class="fa fa-hacker-news"></i></span>
              
                <span class="featured-hackernewsletter" title="Featured in hackernewsletter" data-toggle="tooltip"><i class="fa fa-envelope"></i></span>
              
            </div>
            <a href="/programming/2019/05/16/remove-duplicate-lines-preserving-order-linux"
               class="ga-event-link"
               data-event-category="Featured posts"
               data-event-action="click"
               data-event-label="How to remove duplicate lines from files preserving their order">How to remove duplicate lines from files preserving their order</a>
             <div class="text-muted smaller">
               How to remove duplicate lines of a file in Linux without sorting or changing their order (awk one-liner explained).
             </div>
          </div>
        
      
        
          <div class="section-item">
            <div class="float-right ml-1">
              
                <span class="featured-ruby-weekly" title="Featured in Ruby Weekly" data-toggle="tooltip"><i class="fa fa-diamond"></i></span>
              
            </div>
            <a href="/programming/2016/04/01/duckrails-guide"
               class="ga-event-link"
               data-event-category="Featured posts"
               data-event-action="click"
               data-event-label="DuckRails - Open source development tool for mocking API endpoints">DuckRails - Open source development tool for mocking API endpoints</a>
             <div class="text-muted smaller">
               An introduction and a guide for installing and using DuckRails, a development tool for mocking API endpoints easily and dynamically. Docker image available.
             </div>
          </div>
        
      

      <div class="section-item">
        <a href="/programming/featured"
           class="ga-event-link"
           data-event-category="Featured all posts"
           data-event-action="click"
           data-event-label="View all featured posts">View all featured posts</a>
      </div>
    </div>
  </div>
</div>


  
<div class="alert alert-primary">
  <div class="sidebar-section">
    <div class="section-title">
      <h4><i class="fa fa-bullhorn"></i> recent posts</h4>
    </div>

    

    <div class="section-content">
      
          <div class="section-item">
            <a href="/programming/2019/11/22/i"
               class="ga-event-link"
               data-event-category="Recent posts"
               data-event-action="click"
               data-event-label="i">i</a>
            <div class="text-muted smaller">A poem for var i</div>
          </div>
      
          <div class="section-item">
            <a href="/programming/2019/11/22/mongoid-nested-attributes-embedded-type"
               class="ga-event-link"
               data-event-category="Recent posts"
               data-event-action="click"
               data-event-label="Mongoid - Inheritance: change embedded document's type via nested attributes">Mongoid - Inheritance: change embedded document's type via nested attributes</a>
            <div class="text-muted smaller">How to change the type of an embedded document via nested attributes.</div>
          </div>
      
          <div class="section-item">
            <a href="/cats/2019/11/04/two-step-authentication"
               class="ga-event-link"
               data-event-category="Recent posts"
               data-event-action="click"
               data-event-label="Two step authentication in Ubuntu">Two step authentication in Ubuntu</a>
            <div class="text-muted smaller">Next level two step authentication</div>
          </div>
      
    </div>
  </div>
</div>



  <div class="alert alert-primary">
  <div class="sidebar-section">
    <div class="section-title">
      <h4>
        <i class="fa fa-github"></i> code
      </h4>

      <div class="float-right">

      </div>
    </div>

    <div class="section-content">
      <div class="section-item">
        <a class="ga-event-link" data-event-label="goto repo" data-event-action="click" data-event-category="News github link" href="https://github.com/iridakos/goto">goto</a>: a tool for navigating to aliased directories in the shell with auto complete
      </div>

      <div class="section-item">
        <a class="ga-event-link" data-event-label="elman repo" data-event-action="click" data-event-category="News github link" href="https://github.com/iridakos/elman">elman</a>: a script for full text searching Linux man pages with Elasticsearch
      </div>

      <div class="section-item">
        <a class="ga-event-link" data-event-label="duckrails repo" data-event-action="click" data-event-category="News github link" href="https://github.com/iridakos/duckrails">DuckRails</a>
        version <span class="important">2.1.5</span> is out <img src="/assets/images/news/duckrails.png" class="logo" /> (<a class="ga-event-link" data-event-label="DuckRails GitHub docker wiki" data-event-action="click" data-event-category="News links" href="https://github.com/iridakos/duckrails/wiki/Setup-DuckRails-via-Docker" target="_blank">docker image available</a>)
      </div>
    </div>
  </div>
</div>


  


  
    <div class="alert alert-primary d-none d-md-block">
      <div class="sidebar-section">
        <div class="section-content mt-2">
          
<div class="share-links">
  <a class="btn btn-warning ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Share to Twitter" data-event-action="click" href="https://twitter.com/intent/tweet?text=Creating a bash completion script&url=https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter"></i></a>
  <a class="btn btn-warning ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Share to Facebook" data-event-action="click" href="https://facebook.com/sharer.php?u=https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook"></i></a>
  <a class="btn btn-warning ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Share to Reddit" data-event-action="click" href="https://www.reddit.com/submit" onclick="window.location = 'https://www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false" title="Share on Reddit"><i class="fa fa-reddit"></i></a>
  <a class="btn btn-warning ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Share with email" data-event-action="click" href="mailto:?subject=Creating a bash completion script&amp;body=Creating a bash completion script: https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial"><i class="fa fa-envelope-o" title="Share with email"></i></a>
</div>

<div class="subscribe-links">
  <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <i class="fa fa-rss"></i> Subscribe via RSS
  </button>

  <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to all posts RSS" data-event-action="click" href="/feed.xml">all posts</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to programming posts RSS" data-event-action="click" href="/feeds/programming.xml">all programming related posts</a>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to tutorial posts RSS" data-event-action="click" href="/feeds/tutorials.xml">programming tutorials posts</a>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to opensource posts RSS" data-event-action="click" href="/feeds/opensource.xml">opensource related posts</a>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to ruby posts RSS" data-event-action="click" href="/feeds/ruby.xml">ruby and rails related posts</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to painting posts RSS" data-event-action="click" href="/feeds/painting.xml">painting posts</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item ga-event-link" data-event-label="Creating a bash completion script" data-event-category="Subscribe to cat photo posts RSS" data-event-action="click" href="/feeds/cats.xml">cat photos</a>
  </div>
</div>

        </div>
      </div>
    </div>
  
</div>

        </div>
      </div>
    </div>


    <div class="modal fade" id="image-modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">iridakos images preview</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <div class="modal-body text-center">
                <div class="image-container">
                    <img class="image" />
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <footer class="footer">
  <div class="container-fluid no-gutters">
    <div class="row justify-content-center">
      <div class="col-12 col-md-6">
        <div class="brand mb-1">
          <a href="https://iridakos.com"><strong>iridakos</strong></a>
        </div>

        <div class="contact-links">
          <a class="ga-event-link btn btn-outline-primary font-weight-bold mr-1" data-event-category="Footer links" data-event-action="click" data-event-label="GitHub" href="https://www.github.com/iridakos/"><i class="fa fa-github" aria-hidden="true"></i></a>
          <a class="ga-event-link btn btn-outline-primary font-weight-bold mr-1" data-event-category="Footer links" data-event-action="click" data-event-label="Twitter" href="https://www.twitter.com/lazaru_s/"><i class="fa fa-twitter" aria-hidden="true"></i></a>
          <a class="ga-event-link btn btn-outline-primary font-weight-bold mr-1" data-event-category="Footer links" data-event-action="click" data-event-label="LinkedIn" href="https://www.linkedin.com/in/iridakos/"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
        </div>

        <div class="license mt-1">
          <div class="mb-1">
            <a class="font-weight-bold" rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a>
          </div>

          <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">iridakos</span> by
          <a xmlns:cc="http://creativecommons.org/ns#" href="https://iridakos.com/about/" property="cc:attributionName" rel="cc:attributionURL" class="font-weight-bold">Lazarus Lazaridis</a> is licensed under a <a class="font-weight-bold" rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.
        </div>
      </div>
    </div>
  </div>
</footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76452884-1', 'auto');

  ga('set', 'page', '/programming/2018/03/01/bash-programmable-completion-tutorial')
  ga('send', 'pageview');

</script>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="/assets/javascripts/bootstrap.min.js?1574670109677145845" type="text/javascript"></script>
<script src="/assets/javascripts/docout.js?1574670109677145845" type="text/javascript"></script>
<script src="/assets/javascripts/iridakos.js?1574670109677145845" type="text/javascript"></script>
<script src="/assets/javascripts/search.js?1574670109677145845" type="text/javascript"></script>




  </body>
</html>
