<!DOCTYPE html>
<html lang="el">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="ocs-site-verification" content="e5faa08e01247c38aadf1c1737ff8136">
  <meta name="google-site-verification" content="KqOxy0ecDlfNdfO530ZAbtNBedy49hn2KziyqLK0JGo" />

  <title>Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets</title>

  <link href="https://fonts.googleapis.com/css?family=Indie+Flower|Open+Sans:400,600,700&amp;subset=greek" rel="stylesheet">

  <link rel="icon" href="/assets/images/favicon.ico?v=4" type="image/x-icon">
  <link rel="stylesheet" href="/css/main.css?1588012267219694436">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="alternate" type="application/rss+xml" title="iridakos" href="https://iridakos.com/feed.xml">
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets" />
<meta name="author" content="Lazarus Lazaridis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ένα βοήθημα που περιγράφει βήμα προς βήμα πως να δημιουργήσετε μια εφαρμογή συνομιλιών (chat) από το μηδέν με χρήση Rails και WebSockets (ActionCable)." />
<meta property="og:description" content="Ένα βοήθημα που περιγράφει βήμα προς βήμα πως να δημιουργήσετε μια εφαρμογή συνομιλιών (chat) από το μηδέν με χρήση Rails και WebSockets (ActionCable)." />
<link rel="canonical" href="https://iridakos.com/el/programming/2019/11/19/creating-chat-application-rails-websockets" />
<meta property="og:url" content="https://iridakos.com/el/programming/2019/11/19/creating-chat-application-rails-websockets" />
<meta property="og:site_name" content="iridakos" />
<meta property="og:image" content="https://iridakos.com/assets/images/posts/rails-chat-tutorial/post.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-11-19T08:00:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://iridakos.com/assets/images/posts/rails-chat-tutorial/post.png" />
<meta property="twitter:title" content="Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets" />
<meta name="twitter:site" content="@lazaru_s" />
<meta name="twitter:creator" content="@Lazarus Lazaridis" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://iridakos.com/el/programming/2019/11/19/creating-chat-application-rails-websockets"},"author":{"@type":"Person","name":"Lazarus Lazaridis"},"description":"Ένα βοήθημα που περιγράφει βήμα προς βήμα πως να δημιουργήσετε μια εφαρμογή συνομιλιών (chat) από το μηδέν με χρήση Rails και WebSockets (ActionCable).","@type":"BlogPosting","headline":"Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets","dateModified":"2019-11-19T08:00:00+02:00","datePublished":"2019-11-19T08:00:00+02:00","image":"https://iridakos.com/assets/images/posts/rails-chat-tutorial/post.png","url":"https://iridakos.com/el/programming/2019/11/19/creating-chat-application-rails-websockets","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://iridakos.com/assets/images/site.png"},"name":"Lazarus Lazaridis"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

  <body>
    <div class="header-container">
  <nav class="navbar navbar-expand-lg navbar-light iridakos-navbar">
    <div class="container-fluid no-gutters">
      

      <a class="mr-3 blog-logo-container" href="/el/" alt="αρχική">
        <img class="blog-logo" src="/assets/images/irida-faded.png">
      </a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#header-pages" aria-controls="header-pages" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="header-pages">
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
          

          <li class="nav-item dropdown active">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              προγραμματισμός
            </a>

            <div class="dropdown-menu" aria-labelledby="more">
              <a class="dropdown-item" href="/el/programming/">όλα τα άρθρα</a>
              <a class="dropdown-item" href="/el/programming/featured/">δημοφιλή άρθρα</a>
              <a class="dropdown-item" href="/el/programming/tutorials/">βοηθήματα</a>
              <a class="dropdown-item" href="/el/programming/how-to/">how to άρθρα</a>
              <a class="dropdown-item" href="/el/programming/code/">κώδικας</a>
              <hr class="dropdown-divider">
              <a class="dropdown-item" href="/el/programming/humor/">χιούμορ</a>
            </div>
          </li>

          

          <li class="nav-item ">
              <a class="nav-link" href="/el/cats/" alt="cats">γάτες</a>
          </li>

          

          <li class="nav-item ">
              <a class="nav-link" href="/el/painting/" alt="ζωγραφική">ζωγραφική</a>
          </li>

          

          <li class="nav-item ">
              <a class="nav-link" href="/el/tags/" alt="ετικέτες">ετικέτες</a>
          </li>

          

          <li class="nav-item ">
              <a class="nav-link" href="/el/about/" alt="σχετικά με μένα">σχετικά με μένα</a>
          </li>
        </ul>

        <ul class="navbar-nav mr-0 mt-2 mt-lg-0">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="fa fa-language"></i>
              Ελληνικά
            </a>

            <div class="dropdown-menu" aria-labelledby="more">
              
              <a class="dropdown-item" href="/programming/2019/04/04/creating-chat-application-rails-websockets">English</a>
            </div>
          </li>
        </ul>

        <form class="form-inline my-2 my-lg-0" method="get" action="/el/search">
          <div class="input-group input-group-sm mr-sm-2">
            <input class="form-control" name="query" type="search" placeholder="Αναζήτηση άρθρων">

            <div class="input-group-append">
              <button class="btn btn-warning" type="submit">
                <i class="fa fa-search"></i>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </nav>

  <div class="page-title-container">
    <div class="container-fluid no-gutters">
      <div class="page-title">
        <div class="row align-items-center">
          <div class="col-xs-12 col-md-8 col-lg-9 order-md-first order-last text-center text-md-left">
            <h1>Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets</h1>

              <div class="page-subtitle">
              Ένα βοήθημα που περιγράφει βήμα προς βήμα πως να δημιουργήσετε μια εφαρμογή συνομιλιών (chat) από το μηδέν με χρήση Rails και WebSockets (ActionCable).

              
                <div class="post">
                  <div class="post-metadata">
                    <div class="post-date" title="published on">
                      Δημοσιεύτηκε στις <span class="important">19/11/2019</span>
                    </div>

                    <div class="post-category" title="in category">
                      στην κατηγορία <span class="important">
                        
                             <a href="/el/programming">προγραμματισμός</a>
                          

                      </span>
                    </div>
                  </div>

                  
                  
                    <div class="post-tags">
                      <span class="important">Ετικέτες:</span>
                      
                        <a href="/el/tags/?tag=ruby">ruby</a> - 
                      
                        <a href="/el/tags/?tag=rails">rails</a> - 
                      
                        <a href="/el/tags/?tag=websockets">websockets</a> - 
                      
                        <a href="/el/tags/?tag=devise">devise</a> - 
                      
                        <a href="/el/tags/?tag=bootstrap">bootstrap</a> - 
                      
                        <a href="/el/tags/?tag=chat">chat</a> - 
                      
                        <a href="/el/tags/?tag=actioncable">actioncable</a> - 
                      
                        <a href="/el/tags/?tag=redis">redis</a> - 
                      
                        <a href="/el/tags/?tag=featured">featured</a> - 
                      
                        <a href="/el/tags/?tag=δημοφιλή">δημοφιλή</a> - 
                      
                        <a href="/el/tags/?tag=tutorial">tutorial</a> - 
                      
                        <a href="/el/tags/?tag=βοήθημα">βοήθημα</a> - 
                      
                        <a href="/el/tags/?tag=how-to">how-to</a>
                      
                    </div>
                  

                  
                  
                  
                    <!--googleoff: index-->
                    <div class="my-3">
                      <small>
                        This article is also available in <a href="/programming/2019/04/04/creating-chat-application-rails-websockets">english</a>.
                      </small>
                    </div>
                    <!--googleon: index-->
                  
                </div>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="header-separator"></div>
</div>





    <div class="container-fluid no-gutters">
      <div class="row">
        <div class="col-xs-12 col-md-8 col-lg-9 page-content">
          

          
            <div class="row">
              <div class="col-12">
                <div class="outline mb-3">
                  <h2 id="εισαγωγή">Εισαγωγή</h2>

<p>Σε αυτό το βοήθημα θα δημιουργήσουμε μια εφαρμογή συνομιλιών (<strong>chat</strong>) από το μηδέν χρησιμοποιώντας το framework Ruby on Rails και την τεχνολογία των WebSockets.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/rails-chat-tutorial.gif" alt="Rails chat tutorial gif" /></p>

<p><strong>Ενημέρωση</strong>: Δημοσίευσα άλλο ένα βοήθημα για τη <a href="https://twitter.com/lazaru_s/status/1182193506430984193">δημιουργία docker image της εφαρμογής</a> του παρόντος, μπορείτε να το βρείτε στα αγγλικά για την ώρα <a href="/programming/2019/04/07/dockerizing-a-rails-application"><strong>εδώ</strong></a>.</p>

<div class="alert alert-light">
  <div class="alert-heading"><i class="fa fa-comments"></i> Κώδικας και σχόλια</div>

  Μπορείτε να βρείτε τον κώδικα του παρόντος άρθρου στο <a class="alert-link" href="https://github.com/iridakos/rails-chat-tutorial"><i class="fa fa-github"></i> GitHub</a>.

  <hr />

  Για σχόλια, feedback, λάθη κ.λπ. παρακαλώ ανοίξτε ένα <a class="alert-link" href="https://github.com/iridakos/rails-chat-tutorial/issues">issue</a> στο αποθετήριο.
</div>

<h3 id="τι-είναι-τα-websockets">Τι είναι τα WebSockets;</h3>

<p>Πρόκειται ουσιαστικά για ένα πρωτόκολλο που επιτρέπει την αμφίδρομη επικοινωνία μεταξύ πελάτη και εξυπηρετητή μιας διαδικτυακής εφαρμογής μέσω μιας και μόνης σύνδεσης TCP μακράς διαρκείας.</p>

<blockquote>
  <p>The WebSocket protocol enables interaction between a web browser (or other client application) and a web server <strong>with lower overheads, facilitating real-time data transfer from and to the server</strong>.
<br /><br />This is made possible by providing a standardized way for the server to send content to the client without being first requested by the client, and allowing messages to be passed back and forth while keeping the connection open. In this way, a two-way ongoing conversation can take place between the client and the server.<br /><br />The communications are done over TCP port number 80 (or 443 in the case of TLS-encrypted connections), which is of benefit for those environments which block non-web Internet connections using a firewall. Similar two-way browser-server communications have been achieved in non-standardized ways using stopgap technologies such as Comet.
<cite>– <a href="https://en.wikipedia.org/wiki/WebSocket">WebSocket @ Wikipedia</a></cite></p>
</blockquote>

<h3 id="γιατί-να-χρησιμοποιήσουμε-websockets">Γιατί να χρησιμοποιήσουμε WebSockets;</h3>

<p>Υποθέστε ότι θέλετε να δημιουργήσετε μια ιστοσελίδα που εμφανίζει τις καταστάσεις κάποιων διαδικασιών που βρίσκονται υπό εκτέλεση.
Χωρίς τη χρήση WebSockets, θα έπρεπε να κάνετε ένα από τα παρακάτω:</p>
<ul>
  <li>να χρησιμοποιήσετε AJAX με Javascript intervals για να ζητάτε και να εμφανίζεται τις τρέχουσες καταστάσεις των διαδικασιών</li>
  <li>να φορτώνεται ξανά τη σελίδα κάθε x δευτερόλεπτα (<code class="highlighter-rouge">&lt;meta http-equiv="refresh" content="x"&gt;</code>)</li>
  <li>να προσθέσετε ένα μήνυμα στη σελίδα τύπου <em>“Οι καταστάσεις δεν ενημερώνονται αυτόματα <span class="text-nowrap">¯\_(ツ)_/¯</span> Πατήστε <a href="/el/programming/2019/11/19/creating-chat-application-rails-websockets">εδώ</a> για να φορτώσετε ξανά τη σελίδα.”</em></li>
</ul>

<p>Και οι τρεις παραπάνω προτάσεις θα κατέληγαν στο να ζητήσουν από τον εξυπηρετητή τις καταστάσεις των διαδικασιών ακόμη και να αυτές δεν είχαν αλλάξει.</p>

<p>Τα WebSockets είναι αυτά που θα μας επιτρέψουν αυτού του είδους η επικοινωνία να λάβει χώρα κατά απαίτηση. Το κόστος αυτής της λειτουργικότητας είναι η διατήρηση TCP συνδέσεων μεταξύ του εξυπηρετητή και όλων των πελατών του (μια για κάθε ανοιγμένη σελίδα στον φυλλομετρητή).</p>

<h2 id="χτίζοντας-την-εφαρμογή">Χτίζοντας την εφαρμογή</h2>

<p>Θα χτίσουμε την εφαρμογή χρησιμοποιώντας:</p>

<ul>
  <li><strong>Ruby</strong>: έκδοση <strong>2.6.2</strong></li>
  <li><strong>Rails</strong>: έκδοση <strong>5.2.3</strong></li>
</ul>

<h3 id="στήνοντας-το-περιβάλλον">Στήνοντας το περιβάλλον</h3>

<p>Θα εγκαταστήσουμε τις κατάλληλες εκδόσεις της Ruby και του Ruby on Rails.</p>

<h4 id="εγκατάσταση-ruby">Εγκατάσταση Ruby</h4>

<p>Χρησιμοποιώ το πρόγραμμα <a href="https://rvm.io/">rvm</a> για να διαχειρίζομαι τις εκδόσεις της <strong>Ruby</strong> που εγκαθιστώ στο σύστημά μου. Για να εγκαταστήσετε την Ruby του παρόντος βοηθήματος εκτελέστε:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rvm <span class="nb">install </span>ruby 2.6.2
</code></pre></div></div>

<h4 id="εγκατάσταση-ruby-on-rails">Εγκατάσταση Ruby on Rails</h4>

<p>Δημιουργήστε ένα φάκελο στο σύστημά σας με το όνομα <code class="highlighter-rouge">rails-chat-tutorial</code>.</p>

<p><strong>Περιηγηθείτε σε αυτόν τον φάκελο</strong> και δημιουργήστε τα παρακάτω αρχεία:</p>

<p><em>.ruby-version</em></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby-2.6.2
</code></pre></div></div>

<p><em>.ruby-gemset</em></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails-chat-tutorial
</code></pre></div></div>

<p>Με αυτά τα δύο αρχεία, ενημερώνουμε τον <em>rvm</em> (Ruby version manager) ότι όταν εργαζόμαστε σε αυτόν τον φάκελο, θέλουμε να γίνεται χρήση της συγκεκριμένης έκδοσης Ruby (<code class="highlighter-rouge">.ruby-version</code>) και των συγκεκριμένων βιβλιοθηκών που έχουν εγκατασταθεί στο <em>gemset</em> με το όνομα <code class="highlighter-rouge">rails-chat-tutorial</code> (<code class="highlighter-rouge">.ruby-gemset</code>).</p>

<p>Τώρα, αν περιηγηθείτε ξανά στον φάκελο θα δείτε κάτι σαν τα παρακάτω:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd .

ruby-2.6.2 - #gemset created /home/iridakos/.rvm/gems/ruby-2.6.2@rails-chat-tutorial
ruby-2.6.2 - #generating rails-chat-tutorial wrappers...........
</code></pre></div></div>

<p>Εγκαταστήστε την επιθυμητή έκδοση του Ruby on Rails με:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem install rails -v 5.2.3
</code></pre></div></div>

<h4 id="δημιουργία-της-εφαρμογής">Δημιουργία της εφαρμογής</h4>

<p>Είμαστε έτοιμοι να δημιουργήσουμε την <em>rails</em> εφαρμογή, στη γραμμή εντολών πληκτρολογήστε:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails new .
</code></pre></div></div>

<p><strong>Σημείωση</strong>: Δεν προσδιορίσαμε κάποιο όνομα για την εφαρμογή οπότε το framework θα χρησιμοποιήσει το όνομα του φακέλου: <code class="highlighter-rouge">rails-chat-tutorial</code>.</p>

<p>Το Rails θα δημιουργήσει όλα τα αρχεία της εφαρμογής και θα εγκαταστήσει τις απαιτούμενες βιβλιοθήκες (gems).</p>

<p>Ας ξεκινήσουμε την εφαρμογή για να επιβεβαιώσουμε ότι όλα είναι εντάξει.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails server
</code></pre></div></div>

<p>You should see something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=&gt; Booting Puma
=&gt; Rails 5.2.3 application starting in development
=&gt; Run `rails server -h` for more startup options
Puma starting in single mode...
* Version 3.12.1 (ruby 2.6.2-p47), codename: Llamas in Pajamas
* Min threads: 5, max threads: 5
* Environment: development
* Listening on tcp://localhost:3000
Use Ctrl-C to stop
</code></pre></div></div>

<p>Ανοίξτε έναν φυλλομετρητή και επισκεφθείτε τη διεύθυνση: <code class="highlighter-rouge">http://localhost:3000</code>. Αν βλέπετε το παρακάτω είμαστε εντάξει για να συνεχίσουμε. Αν όχι, δε με ξέρετε δε σας ξέρω :P</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/01-rails-new.png" alt="Rails new application" /></p>

<h3 id="χρήστες-και-βιβλιοθήκη-devise">Χρήστες και βιβλιοθήκη <code class="highlighter-rouge">devise</code></h3>

<p>Θα χρησιμοποιήσουμε την φοβερή λύση της βιβλιοθήκης <a href="https://github.com/plataformatec/devise">devise</a> για πιστοποίηση χρηστών.</p>

<p>Προσαρτήστε την παρακάτω απαίτηση βιβλιοθήκης στο τέλος του αρχείου <code class="highlighter-rouge">Gemfile</code> βρίσκεται στον κεντρικό φάκελο της εφαρμογής (Rails root directory).</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'devise'</span>
</code></pre></div></div>

<p>Στη γραμμή εντολών, εγκαταστήστε τη νέα βιβλιοθήκη εκτελώντας:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle
</code></pre></div></div>

<p>Ολοκληρώστε την ενσωμάτωση της <code class="highlighter-rouge">devise</code> με:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails generate devise:install
</code></pre></div></div>

<p>Θα δημιουργήσουμε το μοντέλο που αναπαριστά τους χρήστες μας χρησιμοποιώντας τις γεννήτριες της <code class="highlighter-rouge">devise</code>.</p>

<p>Εκτελέστε στη γραμμή εντολών:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails generate devise User username:string
</code></pre></div></div>

<p><strong>Σημείωση</strong>: προσθέσαμε ένα επιπλέον χαρακτηριστικό <code class="highlighter-rouge">username</code> στο μοντέλο (πέραν των όσων εξ ορισμού παρήγαγε η βιβλιοθήκη) ούτως ώστε να έχουμε κάτι πιο φιλικό να εμφανίζουμε για τους χρήστες αντί της διεύθυνσης email.</p>

<p>Ανοίξτε το αρχείο προσαρμογής της βάσης (migration) που βρίσκεται στην τοποθεσία <code class="highlighter-rouge">db/migrate/&lt;datetime&gt;_devise_create_users.rb</code> και προσθέστε ένα ευρετήριο μοναδικότητας (unique index) για το χαρακτηριστικό που προσθέσαμε (<code class="highlighter-rouge">username</code>)<sup><a href="#ευχαριστίες">[4]</a></sup>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">add_index</span> <span class="ss">:users</span><span class="p">,</span>  <span class="ss">:username</span><span class="p">,</span>             <span class="ss">unique: </span><span class="kp">true</span>
</code></pre></div></div>

<p>Βρείτε τη γραμμή που ορίζει τη στήλη <code class="highlighter-rouge">username</code> αλλάξτε την ως εξής:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
</code></pre></div></div>

<p>για να δηλώσουμε το χαρακτηριστικό ως υποχρεωτικό.</p>

<p>Στη συνέχεια, στο μοντέλο <code class="highlighter-rouge">User</code> που βρίσκεται στην τοποθεσία <code class="highlighter-rouge">app/models/user.rb</code> προσθέστε τον παρακάτω κανόνα επικύρωσης της μοναδικότητας και της υποχρεωτικής παρουσίας του χαρακτηριστικού:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">validates</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
</code></pre></div></div>

<p>Τέλος, προσαρμόστε τη βάση με:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails db:migrate
</code></pre></div></div>

<h3 id="δωμάτια-και-μηνύματα">Δωμάτια και μηνύματα</h3>

<p>Κάθε μήνυμα θα εμφανίζεται σε ένα δωμάτιο.</p>

<p>Ας δημιουργήσουμε και τα δύο.</p>

<p>Χρησιμοποιήστε την παρακάτω εντολή για δημιουργήσετε το δωμάτιο - <code class="highlighter-rouge">Room</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails generate resource Room name:string:uniq
</code></pre></div></div>

<p>και την ακόλουθη εντολή για να δημιουργήσετε το μήνυμα δωματίου - <code class="highlighter-rouge">RoomMessage</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails generate resource RoomMessage room:references user:references message:text
</code></pre></div></div>

<p>Τώρα θα ορίσουμε τις σχέσεις αυτών των δύο<sup><a href="#ευχαριστίες">[7]</a></sup>.</p>

<p>Ανοίξτε το αρχείο που βρίσκεται στην τοποθεσία <code class="highlighter-rouge">app/models/room.rb</code> και προσθέστε την παρακάτω σχέση μέσα στην κλάση:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">has_many</span> <span class="ss">:room_messages</span><span class="p">,</span> <span class="ss">dependent: :destroy</span><span class="p">,</span>
                         <span class="ss">inverse_of: :room</span>
</code></pre></div></div>

<p>Ανοίξτε το αρχείο που βρίσκεται στην τοποθεσία <code class="highlighter-rouge">app/models/room_message.rb</code> και προσθέστε τις παρακάτω σχέσεις:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">belongs_to</span> <span class="ss">:user</span>
<span class="n">belongs_to</span> <span class="ss">:room</span><span class="p">,</span> <span class="ss">inverse_of: :room_messages</span>
</code></pre></div></div>

<p>Προσαρμόστε τη βάση με την εντολή:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails db:migrate
</code></pre></div></div>

<p>Τώρα μπορούμε να ορίσουμε με τέτοιο τρόπο τις διαδρομές (routes) ώστε τα αιτήματα στην αρχική σελίδα (root requests) να σερβίρονται από την ενέργεια <code class="highlighter-rouge">index</code> του ελεγκτή <code class="highlighter-rouge">RoomsController</code> (που δημιουργήθηκε αυτόματα όταν εκτελέσαμε την εντολή για τη δημιουργία του πόρου <code class="highlighter-rouge">RoomMessage</code> παραπάνω) - <code class="highlighter-rouge">RoomsController#index</code>.</p>

<p>Ανοίξτε το αρχείο που βρίσκεται στην τοποθεσία <code class="highlighter-rouge">config/routes.rb</code> και αλλάξτε τα περιεχόμενά του στα παρακάτω:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">devise_for</span> <span class="ss">:users</span>

  <span class="n">root</span> <span class="ss">controller: :rooms</span><span class="p">,</span> <span class="ss">action: :index</span>

  <span class="n">resources</span> <span class="ss">:room_messages</span>
  <span class="n">resources</span> <span class="ss">:rooms</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Επανεκκινήστε τον εξυπηρετητή και προσπαθήστε να περιηγηθείτε στην αρχική σελίδα της εφαρμογής (http://localhost:3000).</p>

<p>Θα δείτε το παρακάτω λάθος, μην ανησυχείτε:</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/02.png" alt="No action index for the RoomsController" /></p>

<p>Πρέπει να δημιουργήσουμε την ενέργεια <code class="highlighter-rouge">index</code> στον ελεγκτή <code class="highlighter-rouge">RoomsController</code>. Ανοίξτε τον ελεγκτή που βρίσκεται στην τοποθεσία <code class="highlighter-rouge">app/controllers/rooms_controller.rb</code> και αλλάξτε τα περιεχόμενά του στα παρακάτω:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RoomsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Κατόπιν, δημιουργήστε το αρχείο <code class="highlighter-rouge">app/views/rooms/index.html.erb</code> και για την ώρα απλά προσθέστε μόνο την παρακάτω επικεφαλίδα:</p>
<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Rooms index<span class="nt">&lt;/h1&gt;</span>
</code></pre></div></div>

<p>Φορτώστε ξανά την αρχική σελίδα και voilà.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/03.png" alt="Rooms index" /></p>

<h3 id="προσθήκη-πιστοποίησης-χρηστών">Προσθήκη πιστοποίησης χρηστών</h3>

<p>Θέλουμε όλοι οι χρήστες να είναι πιστοποιημένοι πριν να μπορέσουν να συμμετάσχουν σε συνομιλίες οπότε θα προσθέσουμε την παρακάτω γραμμή στην κλάση <code class="highlighter-rouge">ApplicationController</code> που βρίσκεται στην τοποθεσία <em>app/controllers/application_controller.rb</em> και από την οποία κληρονομούν οι ελεγκτές μας:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">before_action</span> <span class="ss">:authenticate_user!</span>
</code></pre></div></div>

<p>Αν πλοηγηθούμε εκ νέου στην αρχική σελίδα <code class="highlighter-rouge">http://localhost:3000</code> θα πρέπει να ανακατευθυνθούμε στη σελίδα πιστοποίησης χρηστών <sup><a href="#ευχαριστίες">[10]</a></sup>.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/04.png" alt="Sign in" /></p>

<p>Πριν συνεχίσουμε με τα ωραία, ας εξοπλίσουμε πρώτα την εφαρμογή με κάποια καλά χαρακτηριστικά.</p>

<h3 id="προσθήκη-bootstrap">Προσθήκη bootstrap</h3>

<p>Θα χρησιμοποιήσουμε το <a href="https://getbootstrap.com/">Bootstrap</a> και θα το ενσωματώσουμε στην εφαρμογή χρησιμοποιώντας τη βιβλιοθήκη <a href="https://github.com/twbs/bootstrap-rubygem">bootstrap-rubygem</a>.</p>

<p>Ακολουθώντας τις οδηγίες της βιβλιοθήκης, προσθέστε τις παρακάτω απαιτήσεις βιβλιοθηκών στο μητρώο των απαιτήσεων <code class="highlighter-rouge">Gemfile</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'bootstrap'</span><span class="p">,</span> <span class="s1">'~&gt; 4.3.1'</span>
<span class="n">gem</span> <span class="s1">'jquery-rails'</span>
</code></pre></div></div>
<p>και εκτελέστε την εντολή <code class="highlighter-rouge">bundle</code> για να κατέβουν και να εγκατασταθούν.</p>

<p>Αλλάξτε την κατάληξη του αρχείου <code class="highlighter-rouge">app/assets/stylesheets/application.css</code> σε <code class="highlighter-rouge">scss</code> και <strong>αντικαταστήστε τα περιεχόμενά του</strong> με:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@import</span> <span class="s1">"bootstrap"</span><span class="p">;</span>
</code></pre></div></div>

<p>Προσθέστε τις ακόλουθες γραμμές στο αρχείο <code class="highlighter-rouge">app/assets/javascript/application.js</code> αμέσως πριν τη γραμμή <code class="highlighter-rouge">//= require_tree .</code> <sup><a href="#ευχαριστίες">[9]</a></sup>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//= require jquery3</span>
<span class="c1">//= require popper</span>
<span class="c1">//= require bootstrap-sprockets</span>
</code></pre></div></div>

<h3 id="προσθήκη-simple_form">Προσθήκη simple_form</h3>

<p>Θα χρησιμοποιήσουμε αυτή την εξαιρετική βιβλιοθήκη για να δημιουργούμε τις φόρμες μας εύκολα.</p>

<p>Προσθέστε την απαίτηση στο αρχείο <code class="highlighter-rouge">Gemfile</code> και εκτελέστε την εντολή <code class="highlighter-rouge">bundle</code> για να το εγκαταστήσετε.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'simple_form'</span>
</code></pre></div></div>

<p>Τέλος, ολοκληρώστε την ενσωμάτωση στην εφαρμογή χρησιμοποιώντας:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails generate simple_form:install <span class="nt">--bootstrap</span>
</code></pre></div></div>

<p><strong>Σημείωση</strong>: Χρησιμοποιήσαμε την οδηγία <em>–bootstrap</em> στην παραπάνω εντολή αφού το <code class="highlighter-rouge">bootstrap</code> είναι το CSS framework που θα χρησιμοποιούμε.</p>

<h3 id="προβολές-devise-με-bootstrap-και-simple_form">Προβολές devise με bootstrap και simple_form</h3>

<p>Η βιβλιοθήκη <code class="highlighter-rouge">devise</code> χρησιμοποιεί τις δικές τις προβολές (views) για πιστοποιήσεις, καταχωρήσεις νέων χρηστών κ.λπ. Παρόλα αυτά, έχουμε τρόπο να προσαρμόσουμε αυτές τις προβολές και εφόσον επιλέξαμε να χρησιμοποιήσουμε τις βιβλιοθήκες <code class="highlighter-rouge">bootstrap</code> και <code class="highlighter-rouge">simple_form</code>, μπορούμε να παράξουμε αυτές τις προβολές ούτως ώστε οι επιλογές μας να γίνουν σεβαστές.</p>

<p>Στη γραμμή εντολών σας:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails generate devise:views
</code></pre></div></div>

<p>Η προβολή για την πιστοποίηση των χρηστών βρίσκεται στην τοποθεσία <code class="highlighter-rouge">app/views/devise/sessions/new.html.erb</code> και για την καταχώρηση χρηστών στην τοποθεσία <code class="highlighter-rouge">app/views/devise/registrations/new.html.erb</code>. Ανοίξτε αυτά τα δύο αρχεία και αλλάξτε τις κλάσεις των κουμπιών υποβολής αντικαθιστώντας την παρακάτω γραμμή<sup><a href="#ευχαριστίες">[6]</a></sup>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">button</span> <span class="ss">:submit</span><span class="p">,</span> <span class="s2">"Sign up"</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>με</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">button</span> <span class="ss">:submit</span><span class="p">,</span> <span class="s2">"Sign up"</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'btn btn-success'</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>ώστε τα κουμπιά να εμφανίζονται ακολουθώντας το στυλ του <em>bootstrap</em>.</p>

<p>Πριν δούμε τις αλλαγές που κάναμε, ας κάνουμε ένα τελευταίο πράγμα στην προκαθορισμένη δομή των προβολών μας (default layout).</p>

<p>Ανοίξτε το αρχείο <code class="highlighter-rouge">app/views/layouts/application.html.erb</code> και αντικαταστήστε τα περιεχόμενά του με τα παρακάτω:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>RailsChatTutorial<span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csp_meta_tag</span> <span class="cp">%&gt;</span>

    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media: </span><span class="s1">'all'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span><span class="p">:</span> <span class="s1">'reload'</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span><span class="p">:</span> <span class="s1">'reload'</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>

  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12"</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>ώστε να χρησιμοποιούμε το <a href="https://getbootstrap.com/docs/4.0/layout/grid/">Bootstrap’s πλέγμα (grid)</a> στις προβολές.</p>

<p>Περιηγηθείτε στην αρχική σελίδα <code class="highlighter-rouge">http://localhost:3000</code> και δείτε τι δημιουργήσαμε.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/05.png" alt="Sign in with Devise and simple form" /></p>

<p>Ας προσπαθήσουμε να κάνουμε καταχώρηση χρήστη ακολουθώντας το σύνδεσμο <code class="highlighter-rouge">Sign up</code> της φόρμας:</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/06.png" alt="Sign up without username" /></p>

<p>Όπως βλέπετε, δεν υπάρχει πεδίο για τη συμπλήρωση του ονόματος χρήστη (<code class="highlighter-rouge">username</code>) που προσθέσαμε όταν δημιουργήσαμε το μοντέλο <code class="highlighter-rouge">User</code>. Για να μπορούν οι χρήστες να καταχωρούν το όνομά τους πρέπει:</p>

<ul>
  <li>να προσθέσουμε το πεδίο στη φόρμα</li>
  <li>να ενημερώσουμε τη βιβλιοθήκη <code class="highlighter-rouge">devise</code> ώστε να αναγνωρίζει και να δέχεται το νέο χαρακτηριστικό (<code class="highlighter-rouge">username</code>) διαφορετικά ο ελεγκτής <code class="highlighter-rouge">ApplicationController</code> θα <a href="https://api.rubyonrails.org/classes/ActionController/Parameters.html">το αγνοεί</a> όταν θα υποβάλλουμε τη φόρμα.</li>
</ul>

<p>Για να προσθέσουμε το πεδίο στη φόρμα καταχώρησης χρηστών, ανοίξτε το αρχείο <code class="highlighter-rouge">app/views/devise/registrations/new.html.erb</code> και προσθέστε αυτές τις γραμμές μεταξύ των πεδίων <code class="highlighter-rouge">email</code> και <code class="highlighter-rouge">password</code>.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">input</span> <span class="ss">:username</span><span class="p">,</span>
              <span class="ss">required: </span><span class="kp">true</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Κατόπιν, ανοίξτε τον ελεγκτή της εφαρμογής <code class="highlighter-rouge">app/controllers/application_controller.rb</code> για να ρυθμίσετε καταλλήλως τα επιτρεπόμενα χαρακτηριστικά. Αλλάξτε τα περιεχόμενά του στα παρακάτω:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_action</span> <span class="ss">:authenticate_user!</span>

  <span class="n">before_action</span> <span class="ss">:configure_permitted_parameters</span><span class="p">,</span> <span class="ss">if: :devise_controller?</span>

  <span class="kp">protected</span>

  <span class="k">def</span> <span class="nf">configure_permitted_parameters</span>
    <span class="n">devise_parameter_sanitizer</span><span class="p">.</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:sign_up</span><span class="p">,</span> <span class="ss">keys: </span><span class="p">[</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">:username</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Αυτό ήταν, περιηγηθείτε ξανά στην αρχική σελίδα και δοκιμάστε να καταχωρηθείτε ως χρήστες<sup><a href="#ευχαριστίες">[5]</a></sup>.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/07.png" alt="Sign up with username" /></p>

<h3 id="καθάρισμα-μη-χρησιμοποιούμενων-στοιχείων">Καθάρισμα μη χρησιμοποιούμενων στοιχείων</h3>

<p>Δε θα χρησιμοποιήσουμε <code class="highlighter-rouge">coffee script</code> ή τα <code class="highlighter-rouge">turbolinks</code> οπότε ας αφαιρέσουμε τις σχετικές αναφορές.</p>

<p>Ανοίξτε το <code class="highlighter-rouge">Gemfile</code> και αφαιρέστε τις παρακάτω γραμμές:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Use CoffeeScript for .coffee assets and views</span>
<span class="n">gem</span> <span class="s1">'coffee-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 4.2'</span>
<span class="c1"># Turbolinks makes navigating your web application faster. Read more: https://github.com/turbolinks/turbolinks</span>
<span class="n">gem</span> <span class="s1">'turbolinks'</span><span class="p">,</span> <span class="s1">'~&gt; 5'</span>
</code></pre></div></div>

<p>Ανοίξτε το αρχείο <code class="highlighter-rouge">app/assets/javascripts/application.js</code> και αφαιρέστε την παρακάτω γραμμή:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//= require turbolinks</span>
</code></pre></div></div>

<p>Ανοίξτε το <code class="highlighter-rouge">app/views/layouts/application.html.erb</code> και αλλάξτε τις παρακάτω γραμμές<sup><a href="#ευχαριστίες">[3]</a></sup> από:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media: </span><span class="s1">'all'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span><span class="p">:</span> <span class="s1">'reload'</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span><span class="p">:</span> <span class="s1">'reload'</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>σε</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media: </span><span class="s1">'all'</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Ελέγξτε ότι ο φάκελος <code class="highlighter-rouge">app/assets/javascripts</code> δεν έχει αρχεία με κατάληξη <code class="highlighter-rouge">.coffee</code> και αν έχει, αφαιρέστε τα.<sup><a href="#ευχαριστίες">2</a><sup></sup></sup></p>

<p>Στη γραμμή εντολών τέλος, εκτελέστε:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails tmp:cache:clear
</code></pre></div></div>

<p>για να καθαρίσετε ότι αρχεία coffee scripts είχαν ενδεχομένως ενταχθεί στην cache.</p>

<p>Αυτά. Επανεκκινήστε τον εξυπηρετητή.</p>

<h3 id="προσθήκη-μπάρας-πλοήγησης">Προσθήκη μπάρας πλοήγησης</h3>

<p>Για να βελτιώσουμε τη χρηστικότητα της εφαρμογής θα προσθέσουμε μια <a href="https://getbootstrap.com/docs/4.0/components/navbar/">μπάρα πλοήγησης</a>.</p>

<p>Δημιουργήστε το φάκελο <code class="highlighter-rouge">app/views/shared</code> και ένα αρχείο μέσα του με το όνομα <code class="highlighter-rouge">_navigation_bar.html.erb</code>. Αυτό θα είναι ένα απόσπασμα (partial) που θα εμφανίζει την μπάρα πλοήγησης και που στη συνέχεια θα προσθέσουμε στην κεντρική δομή των ιστοσελίδων της εφαρμογής (application layout) για να εμφανίζεται σε όλες τις σελίδες. Προσθέστε μέσα του τα παρακάτω:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"navbar navbar-expand-lg navbar-dark bg-dark justify-content-between"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"navbar-brand"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Rails chat tutorial<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"navbar-toggler"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">data-toggle=</span><span class="s">"collapse"</span> <span class="na">data-target=</span><span class="s">"#nav-bar-collapse"</span> <span class="na">aria-controls=</span><span class="s">"navbarColor01"</span> <span class="na">aria-expanded=</span><span class="s">"false"</span> <span class="na">aria-label=</span><span class="s">"Toggle navigation"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"navbar-toggler-icon"</span><span class="nt">&gt;&lt;/span&gt;</span>
  <span class="nt">&lt;/button&gt;</span>

  <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">current_user</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dropdown"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link dropdown-toggle"</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">id=</span><span class="s">"navbarDropdown"</span> <span class="na">role=</span><span class="s">"button"</span> <span class="na">data-toggle=</span><span class="s">"dropdown"</span> <span class="na">aria-haspopup=</span><span class="s">"true"</span> <span class="na">aria-expanded=</span><span class="s">"false"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"avatar"</span> <span class="na">src=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">gravatar_url</span><span class="p">(</span><span class="n">current_user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">current_user</span><span class="p">.</span><span class="nf">username</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/a&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dropdown-menu dropdown-menu-right"</span> <span class="na">aria-labelledby=</span><span class="s">"navbarDropdown"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Logout'</span><span class="p">,</span> <span class="n">destroy_user_session_path</span><span class="p">,</span> <span class="ss">method: :delete</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'dropdown-item'</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</code></pre></div></div>

<p>Δώστε προσοχή στη γραμμή <code class="highlighter-rouge">gravatar_url(current_user)</code>. Αυτή είναι μια βοηθητική μέθοδος που θα χρησιμοποιούμε για να εμφανίζουμε την εικόνα προφίλ (<code class="highlighter-rouge">gravatar</code>) των πιστοποιημένων χρηστών. Δεν είναι συστημική μέθοδος, θα την υλοποιήσουμε εμείς αλλά είναι αρκετά απλή.</p>

<p>Ανοίξτε το αρχείο με τις βοηθητικές μεθόδους <code class="highlighter-rouge">app/helpers/application_helper.rb</code> και προσθέστε τον παρακάτω κώδικα:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">gravatar_url</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
  <span class="n">gravatar_id</span> <span class="o">=</span> <span class="no">Digest</span><span class="o">::</span><span class="no">MD5</span><span class="o">::</span><span class="n">hexdigest</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="nf">email</span><span class="p">).</span><span class="nf">downcase</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://gravatar.com/avatar/</span><span class="si">#{</span><span class="n">gravatar_id</span><span class="si">}</span><span class="s2">.png"</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Σημείωση</strong>:</p>
<ul>
  <li>Όπως μπορείτε να δείτε το όνομα του χρήστη, η εικόνα προφίλ και ο σύνδεσμος εξόδου από την εφαρμογή θα εμφανίζονται μόνο όταν ο χρήστης έχει συνδεθεί.</li>
</ul>

<p>Η εικόνα προφίλ έχει μια CSS κλάση <code class="highlighter-rouge">avatar</code>. Πρέπει να ορίσουμε αυτήν την κλάση σε κάποιο αρχείο stylesheet της εφαρμογής. Δημιουργήστε ένα αρχείο (στο οποίο θα συγκεντρώσουμε όλες τις CSS κλάσεις που θα χρησιμοποιήσουμε πέραν αυτών που παρέχονται από το <code class="highlighter-rouge">bootstrap</code>) με το όνομα <code class="highlighter-rouge">app/assets/stylesheets/rails-chat-tutorial.scss</code>.</p>

<p>Για την ώρα προσθέστε τον κανόνα για την εικόνα προφίλ:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.avatar</span> <span class="p">{</span>
  <span class="nl">max-height</span><span class="p">:</span><span class="m">30px</span><span class="p">;</span>
  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">15px</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span><span class="nb">auto</span><span class="p">;</span>
  <span class="nl">vertical-align</span><span class="p">:</span><span class="nb">middle</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>και ανοίξτε το αρχείο <code class="highlighter-rouge">application.scss</code> για να το προσθέσετε στο μητρώο stylesheet της εφαρμογής. Προσθέστε τη γραμμή:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@import "rails-chat-tutorial"
</code></pre></div></div>

<p>Τώρα θα προσθέσουμε το απόσπασμα της μπάρας πλοήγησης που δημιουργήσαμε στην προκαθορισμένη δομή των σελίδων της εφαρμογής. Ανοίξτε το αρχείο <code class="highlighter-rouge">app/views/layouts/application.html.erb</code> και αλλάξτε τα περιεχόμενά του στα παρακάτω:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>RailsChatTutorial<span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csp_meta_tag</span> <span class="cp">%&gt;</span>

    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media: </span><span class="s1">'all'</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>

  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12"</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s1">'shared/navigation_bar'</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"my-3"</span><span class="nt">&gt;</span>
            <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Φορτώστε ξανά την αρχική σελίδα και δείτε την μπάρα.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/08.png" alt="Sign up with navigation bar" /></p>

<p>Τέλεια. Συμπληρώστε τα επιθυμητά στοιχεία εισόδου σας και υποβάλετε τη φόρμα.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/09.png" alt="Signed in" /></p>

<h3 id="διαχείριση-δωματίων">Διαχείριση δωματίων</h3>

<p>Θα δημιουργήσουμε μια απλή δομή για τα δωμάτια.</p>

<ul>
  <li>Μια μικρή στήλη που θα εμφανίζει κάθετα όλα τα διαθέσιμα δωμάτια</li>
  <li>Μια μεγάλη στήλη που θα περιέχει τα μηνύματα και τη φόρμα υποβολής μηνύματος.</li>
</ul>

<p>Οι αρχική σελίδα των δωματίων θα έχει τη δεξιά στήλη άδεια, η τελευταία θα εμφανίζεται μόνο όταν ο χρήστης έχει επιλέξει συγκεκριμένο δωμάτιο.</p>

<p>Τέλος, στην αρχική σελίδα των δωματίων θα παρέχουμε και την επιλογή για δημιουργία νέου δωματίου.</p>

<h4 id="αρχική-σελίδα-δωματίων">Αρχική σελίδα δωματίων</h4>

<p>Πρώτα θα πρέπει να φορτώσουμε όλα τα διαθέσιμα δωμάτια στον ελεγκτή <code class="highlighter-rouge">RoomsController</code>. Ανοίξτε το αρχείο <code class="highlighter-rouge">app/controllers/rooms_controller.rb</code> και αλλάξτε την μέθοδο <code class="highlighter-rouge">index</code> όπως παρακάτω:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">index</span>
  <span class="vi">@rooms</span> <span class="o">=</span> <span class="no">Room</span><span class="p">.</span><span class="nf">all</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Ανοίξτε την προβολή <code class="highlighter-rouge">app/views/rooms/index.html.erb</code> και αλλάξτε τα περιεχόμενά της στα παρακάτω<sup><a href="#ευχαριστίες">[8]</a></sup>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12 col-md-3"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-3"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">new_room_path</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"btn btn-primary"</span> <span class="k">do</span> <span class="cp">%&gt;</span>
        Create a room
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@rooms</span><span class="p">.</span><span class="nf">present?</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"nav flex-column"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%</span> <span class="vi">@rooms</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">room</span><span class="o">|</span> <span class="cp">%&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">room</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="n">room_path</span><span class="p">(</span><span class="n">room</span><span class="p">),</span> <span class="ss">class: </span><span class="s2">"nav-link room-nav-link"</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span>
        The are no rooms
      <span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-primary"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"alert-heading"</span><span class="nt">&gt;</span>
        Welcome to the RailsChatTutorial!
      <span class="nt">&lt;/h4&gt;</span>

      <span class="nt">&lt;p&gt;</span>
        We need to talk.
      <span class="nt">&lt;/p&gt;</span>

      <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>

      <span class="nt">&lt;p&gt;</span>
        You can create or join a room from the sidebar.
      <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Αν υπάρχουν δωμάτια, η αριστερή στήλη θα εμφανίζει μια κάθετη πλοήγηση με συνδέσμους που οδηγούν στη σελίδα κάθε δωματίου. Η δεξιά στήλη εμφανίζει ένα απλό μήνυμα καλωσορίσματος στην εφαρμογή.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/10.png" alt="Room index" /></p>

<p>Πατώντας το κουμπί <code class="highlighter-rouge">Create a room</code> εμφανίζεται ένα αναμενόμενο λάθος καθώς ο ελεγκτής δεν υποστηρίζει ακόμη την ενέργεια δημιουργίας δωματίου.</p>

<h4 id="δημιουργία-και-επεξεργασία-δωματίου">Δημιουργία και επεξεργασία δωματίου</h4>

<p>Θα ορίσουμε τις ενέργειες για τη δημιουργία και την επεξεργασία ενός δωματίου.</p>

<p>Ανοίξτε τον ελεγκτή των δωματίων <code class="highlighter-rouge">app/controllers/rooms_controller.rb</code> και αλλάξτε τα περιεχόμενά του ως εξής:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RoomsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># Loads:</span>
  <span class="c1"># @rooms = all rooms</span>
  <span class="c1"># @room = current room when applicable</span>
  <span class="n">before_action</span> <span class="ss">:load_entities</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@rooms</span> <span class="o">=</span> <span class="no">Room</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@room</span> <span class="o">=</span> <span class="no">Room</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@room</span> <span class="o">=</span> <span class="no">Room</span><span class="p">.</span><span class="nf">new</span> <span class="n">permitted_parameters</span>

    <span class="k">if</span> <span class="vi">@room</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">flash</span><span class="p">[</span><span class="ss">:success</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Room </span><span class="si">#{</span><span class="vi">@room</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> was created successfully"</span>
      <span class="n">redirect_to</span> <span class="n">rooms_path</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="k">if</span> <span class="vi">@room</span><span class="p">.</span><span class="nf">update_attributes</span><span class="p">(</span><span class="n">permitted_parameters</span><span class="p">)</span>
      <span class="n">flash</span><span class="p">[</span><span class="ss">:success</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Room </span><span class="si">#{</span><span class="vi">@room</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> was updated successfully"</span>
      <span class="n">redirect_to</span> <span class="n">rooms_path</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">protected</span>

  <span class="k">def</span> <span class="nf">load_entities</span>
    <span class="vi">@rooms</span> <span class="o">=</span> <span class="no">Room</span><span class="p">.</span><span class="nf">all</span>
    <span class="vi">@room</span> <span class="o">=</span> <span class="no">Room</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">permitted_parameters</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:room</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Σημείωση</strong>: φορτώνουμε από πριν τις μεταβλητές που κρατούν τα δωμάτια (<code class="highlighter-rouge">@rooms</code>)  και το τρέχον δωμάτιο (<code class="highlighter-rouge">@room</code>) ώστε να είναι διαθέσιμες σε όλες τις ενέργειες χρησιμοποιώντας την οδηγία <code class="highlighter-rouge">before_action :load_entities</code> (action hook).</p>

<p>Θα δημιουργήσουμε μια απλή φόρμα για το μοντέλο <code class="highlighter-rouge">Room</code> και θα τη χρησιμοποιήσουμε και για τη δημιουργία αλλά και για την επεξεργασία ενός δωματίου. Δημιουργήστε την προβολή <code class="highlighter-rouge">app/views/rooms/_form.html.erb</code> και προσθέστε τα παρακάτω:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">simple_form_for</span> <span class="vi">@room</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">input</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="s2">"Save"</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'btn btn-success'</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Στη συνέχεια, δημιουργήστε τις προβολές των ενεργειών <code class="highlighter-rouge">new</code> και <code class="highlighter-rouge">edit</code> αντίστοιχα:</p>

<p><em>app/views/rooms/new.html.erb</em></p>
<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>
  Creating a room  
<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s1">'form'</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p><em>app/views/rooms/edit.html.erb</em></p>
<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>
  Editing room <span class="cp">&lt;%=</span> <span class="vi">@room</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s1">'form'</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Ώρα να φτιάξουμε το πρώτο μας δωμάτιο. Από την αρχική σελίδα των δωματίων, πατήστε το κουμπί <code class="highlighter-rouge">Create a room</code></p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/11.png" alt="New room" /></p>

<p>Σώστε το και ορίστε:</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/12.png" alt="Room index with rooms" /></p>

<p>Προσθέστε την παρακάτω κλάση στο αρχείο <code class="highlighter-rouge">app/assets/stylesheets/rails-chat-tutorial.scss</code> για να βελτιώσουμε την εμφάνιση των δωματίων.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.room-nav-link</span> <span class="p">{</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="n">lighten</span><span class="p">(</span><span class="err">$</span><span class="n">primary</span><span class="p">,</span> <span class="m">40%</span><span class="p">);</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">lighten</span><span class="p">(</span><span class="err">$</span><span class="n">primary</span><span class="p">,</span> <span class="m">45%</span><span class="p">);</span>

  <span class="err">&amp;</span> <span class="err">+</span> <span class="err">.room-nav-link</span> <span class="err">{</span>
    <span class="nl">border-top</span><span class="p">:</span> <span class="m">0</span> <span class="nb">none</span><span class="p">;</span>
  <span class="p">}</span>
<span class="err">}</span>
</code></pre></div></div>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/13.png" alt="Room index with improved rooms" /></p>

<p><strong>Σημείωση</strong>: Θα προσθέσουμε παρακάτω τον σύνδεσμο επεξεργασίας (<code class="highlighter-rouge">edit</code>) ενός δωματίου.</p>

<p>Πριν προχωρήσουμε στη σελίδα προβολής ενός δωματίου, θα αλλάξουμε τον κώδικα της αρχικής σελίδας των δωματίων ώστε να μπορούμε να χρησιμοποιήσουμε την αριστερή στήλη και μέσα στη σελίδα ενός δωματίου.</p>

<p>Δημιουργήστε το απόσπασμα προβολής <code class="highlighter-rouge">app/views/rooms/_rooms.html.erb</code> με τα εξής περιεχόμενα:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-3"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">new_room_path</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'btn btn-primary'</span> <span class="k">do</span> <span class="cp">%&gt;</span>
    Create a room
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@rooms</span><span class="p">.</span><span class="nf">present?</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"nav flex-column"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%</span> <span class="vi">@rooms</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">room</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">room</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="n">room_path</span><span class="p">(</span><span class="n">room</span><span class="p">),</span> <span class="ss">class: </span><span class="s1">'nav-link room-nav-link'</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span>
    The are no rooms
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>και προσαρμόστε την αρχική σελίδα των δωματίων <code class="highlighter-rouge">app/views/rooms/index.html.erb</code> ώστε να το χρησιμοποιεί:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12 col-md-3"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s1">'rooms'</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-primary"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"alert-heading"</span><span class="nt">&gt;</span>
        Welcome to the RailsChatTutorial!
      <span class="nt">&lt;/h4&gt;</span>

      <span class="nt">&lt;p&gt;</span>
        We need to talk.
      <span class="nt">&lt;/p&gt;</span>

      <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>

      <span class="nt">&lt;p&gt;</span>
        You can create or join a room from the sidebar.
      <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<h4 id="σελίδα-δωματίου">Σελίδα δωματίου</h4>

<p>Προσθέστε την ενέργεια προβολής ενός δωματίου <code class="highlighter-rouge">show</code> στον ελεγκτή των δωματίων <code class="highlighter-rouge">app/controllers/rooms_controller.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">show</span>
  <span class="vi">@room_message</span> <span class="o">=</span> <span class="no">RoomMessage</span><span class="p">.</span><span class="nf">new</span> <span class="ss">room: </span><span class="vi">@room</span>
  <span class="vi">@room_messages</span> <span class="o">=</span> <span class="vi">@room</span><span class="p">.</span><span class="nf">room_messages</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Σημειώσεις:</strong></p>
<ul>
  <li>Δημιουργούμε ένα νέο μήνυμα (<code class="highlighter-rouge">@room_message</code>) για να το χρησιμοποιήσουμε στην προβολή όταν θα δημιουργήσουμε τη φόρμα για την υποβολή νέου μηνύματος.</li>
  <li>Όταν εμφανίζουμε ένα μήνυμα στο δωμάτιο, προσπελαύνουμε την email διεύθυνση του χρήστη που το δημιούργησε για να μπορούμε να υπολογίσουμε το hash της <code class="highlighter-rouge">gravatar</code> εικόνας προφίλ του. Χρησιμοποιήσαμε λοιπόν την μέθοδο <code class="highlighter-rouge">.includes(:user)</code> στο ερώτημα της βάσης για τα μηνύματα δωματίου <code class="highlighter-rouge">@room_messages</code> ώστε να προσκομίζονται και οι χρήστες ταυτόχρονα για να αποφύγουμε το πρόβλημα με τα <a href="https://medium.com/@bretdoucette/n-1-queries-and-how-to-avoid-them-a12f02345be5">N+1 ερωτήματα</a><sup><a href="#ευχαριστίες">[1]</a></sup>.</li>
</ul>

<p>Δημιουργήστε την προβολή δωματίου <code class="highlighter-rouge">app/views/rooms/show.html.erb</code>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@room</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12 col-md-3"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s1">'rooms'</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"chat"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%</span> <span class="vi">@room_messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">room_message</span><span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">room_message</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="cp">&lt;%=</span> <span class="n">simple_form_for</span> <span class="vi">@room_message</span><span class="p">,</span> <span class="ss">remote: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-group mb-3"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">input</span> <span class="ss">:message</span><span class="p">,</span> <span class="ss">as: :string</span><span class="p">,</span>
                                 <span class="ss">wrapper: </span><span class="kp">false</span><span class="p">,</span>
                                 <span class="ss">label: </span><span class="kp">false</span><span class="p">,</span>
                                 <span class="ss">input_html: </span><span class="p">{</span>
                                   <span class="ss">class: </span><span class="s1">'chat-input'</span>
                                 <span class="p">}</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-group-append"</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="s2">"Send"</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'btn btn-primary chat-input'</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">input</span> <span class="ss">:room_id</span><span class="p">,</span> <span class="ss">as: :hidden</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p><strong>Σημειώσεις:</strong></p>
<ul>
  <li>Επαναχρησιμοποιήσαμε το απόσπασμα προβολής <code class="highlighter-rouge">app/views/rooms/_rooms.html.erb</code> που δημιουργήσαμε στο προηγούμενο βήμα</li>
  <li>Προσθέσαμε ένα <code class="highlighter-rouge">div</code> με κλάση <code class="highlighter-rouge">.chat</code> και σε αυτό θα εμφανίζονται τα μηνύματα του δωματίου</li>
  <li>Προσθέσαμε μια φόρμα για το μήνυμα <code class="highlighter-rouge">@room_message</code> που αρχικοποιήσαμε στον ελεγκτή. Επίσης χρησιμοποιήσαμε την οδηγία <code class="highlighter-rouge">remote: true</code> όταν αρχικοποιήσαμε τη φόρμα συνεπώς η υποβολή της θα γίνεται μέσω <strong>Ajax</strong>.</li>
  <li>Προσθέσαμε ένα κρυφό πεδίο για το χαρακτηριστικό <code class="highlighter-rouge">:room_id</code> ώστε να είναι διαθέσιμο στον ελεγκτή των μηνυμάτων <code class="highlighter-rouge">RoomMessagesController</code> κατά την υποβολή της φόρμας</li>
</ul>

<p>Ας ομορφύνουμε τα στοιχεία της συνομιλίας προσθέτοντας τις παρακάτω γραμμές στο αρχείο <code class="highlighter-rouge">app/assets/stylesheets/rails-chat-tutorial.scss</code>:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.chat</span> <span class="p">{</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="n">lighten</span><span class="p">(</span><span class="err">$</span><span class="n">secondary</span><span class="p">,</span> <span class="m">40%</span><span class="p">);</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">lighten</span><span class="p">(</span><span class="err">$</span><span class="n">secondary</span><span class="p">,</span> <span class="m">50%</span><span class="p">);</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">50vh</span><span class="p">;</span>
  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">5px</span> <span class="m">5px</span> <span class="m">0</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">overflow-y</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.chat-input</span> <span class="p">{</span>
  <span class="nl">border-top</span><span class="p">:</span> <span class="m">0</span> <span class="nb">none</span><span class="p">;</span>
  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">5px</span> <span class="m">5px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Περιηγηθείτε σε ένα δωμάτιο για να δούμε τι έχουμε κάνει μέχρι στιγμής.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/14.png" alt="Room page with chat" /></p>

<p>Πατώντας το κουμπή <code class="highlighter-rouge">Send</code> δε συμβαίνει τίποτα στη σελίδα αλλά αν κοιτάξετε το αρχείο καταγραφής (log) του εξυπηρετητή θα παρατηρήσετε το εξής:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AbstractController::ActionNotFound (The action 'create' could not be found for RoomMessagesController):
</code></pre></div></div>

<p>Ας το διορθώσουμε.</p>

<h4 id="δημιουργία-μηνυμάτων">Δημιουργία μηνυμάτων</h4>

<p>Αυτό θα είναι απλό. Το μόνο που έχουμε να κάνουμε είναι να υλοποιήσουμε την ενέργεια της δημιουργίας - <code class="highlighter-rouge">create</code> στον ελεγκτή των μηνυμάτων - <code class="highlighter-rouge">RoomMessagesController</code>.</p>

<p><em>app/controllers/room_messages_controller.rb</em></p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RoomMessagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:load_entities</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@room_message</span> <span class="o">=</span> <span class="no">RoomMessage</span><span class="p">.</span><span class="nf">create</span> <span class="ss">user: </span><span class="n">current_user</span><span class="p">,</span>
                                       <span class="ss">room: </span><span class="vi">@room</span><span class="p">,</span>
                                       <span class="ss">message: </span><span class="n">params</span><span class="p">.</span><span class="nf">dig</span><span class="p">(</span><span class="ss">:room_message</span><span class="p">,</span> <span class="ss">:message</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">protected</span>

  <span class="k">def</span> <span class="nf">load_entities</span>
    <span class="vi">@room</span> <span class="o">=</span> <span class="no">Room</span><span class="p">.</span><span class="nf">find</span> <span class="n">params</span><span class="p">.</span><span class="nf">dig</span><span class="p">(</span><span class="ss">:room_message</span><span class="p">,</span> <span class="ss">:room_id</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Σημειώσεις:</strong></p>
<ul>
  <li>φορτώνουμε εκ των προτέρων το δωμάτιο χρησιμοποιώντας την παράμετρο <code class="highlighter-rouge">room_id</code> που προσθέσαμε προηγουμένως σαν κρυφό πεδίο στη φόρμα του μηνύματος</li>
  <li>δημιουργούμε ένα νέο μήνυμα θέτοντας του ως χρήστη τον χρήστη που είναι πιστοποιημένος κατά την υποβολή</li>
</ul>

<p>Αν δοκιμάσετε να υποβάλετε ένα μήνυμα τώρα, και πάλι δε θα δείτε να συμβαίνει κάτι στη σελίδα αλλά στα logs του εξυπηρετητή θα δείτε ότι το μήνυμα δημιουργήθηκε επιτυχώς.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Started POST "/room_messages" for ::1 at 2019-04-04 19:24:33 +0300
Processing by RoomMessagesController#create as JS
  Parameters: {"utf8"=&gt;"✓", "room_message"=&gt;{"message"=&gt;"My first message", "room_id"=&gt;"8"}, "commit"=&gt;"Send"}
  User Load (0.2ms)  SELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?  [["id", 1], ["LIMIT", 1]]
  ↳ /home/iridakos/.rvm/gems/ruby-2.6.2@rails-chat-tutorial/gems/activerecord-5.2.3/lib/active_record/log_subscriber.rb:98
  Room Load (0.2ms)  SELECT  "rooms".* FROM "rooms" WHERE "rooms"."id" = ? LIMIT ?  [["id", 8], ["LIMIT", 1]]
  ↳ app/controllers/room_messages_controller.rb:13
   (0.1ms)  begin transaction
  ↳ app/controllers/room_messages_controller.rb:5
  RoomMessage Create (0.7ms)  INSERT INTO "room_messages" ("room_id", "user_id", "message", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)  [["room_id", 8], ["user_id", 1], ["message", "My first message"], ["created_at", "2019-04-04 16:24:33.456641"], ["updated_at", "2019-04-04 16:24:33.456641"]]
  ↳ app/controllers/room_messages_controller.rb:5
   (4.0ms)  commit transaction
  ↳ app/controllers/room_messages_controller.rb:5
No template found for RoomMessagesController#create, rendering head :no_content
Completed 204 No Content in 88ms (ActiveRecord: 5.1ms)
</code></pre></div></div>

<p>Οι χρήστες περιμένουν το πεδίο του μηνύματος να καθαρίζει μετά την αποστολή ενός μηνύματος. Ας μην τους αφήσουμε να περιμένουν.</p>

<p>Δημιουργήστε ένα αρχείο <code class="highlighter-rouge">app/assets/javascripts/room.js</code> και προσθέστε τα παρακάτω:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#new_room_message</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">ajax:success</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span><span class="nx">c</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[type="text"]</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Συνδέουμε το συμβάν <code class="highlighter-rouge">ajax:success</code> που πυροδοτείται από το <a href="https://guides.rubyonrails.org/working_with_javascript_in_rails.html#form-with">Rails</a> στην επιτυχή υποβολή της φόρμας και το μόνο που κάνουμε είναι ότι καθαρίζουμε τα περιεχόμενα του πεδίου κειμένου του μηνύματος.</p>

<p>Φορτώστε εκ νέου τη σελίδα και προσπαθήστε να υποβάλετε ξανά και δείτε την αλλαγή που μόλις κάναμε. Το πεδίο του μηνύματος θα πρέπει να καθαρίσει μετά την υποβολή της φόρμας.</p>

<h4 id="εμφάνιση-μηνυμάτων">Εμφάνιση μηνυμάτων</h4>

<p>Αν φορτώσετε πάλι τη σελίδα του δωματίου θα δείτε κάτι σαν αυτό:</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/15.png" alt="Room message to string" /></p>

<p>Ας ομορφύνουμε και τα μηνύματα.</p>

<p>Αντικαταστήστε τα περιεχόμενα της προβολής του δωματίου <code class="highlighter-rouge">app/views/rooms/show.html.erb</code> με τα παρακάτω:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@room</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12 col-md-3"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s1">'rooms'</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"chat"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%</span> <span class="vi">@room_messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">room_message</span><span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"chat-message-container"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row no-gutters"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-auto text-center"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">gravatar_url</span><span class="p">(</span><span class="n">room_message</span><span class="p">.</span><span class="nf">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="s">"</span> <span class="na">class=</span><span class="s">"avatar"</span> <span class="na">alt=</span><span class="s">""</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"message-content"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"mb-1"</span><span class="nt">&gt;</span>
                  <span class="cp">&lt;%=</span> <span class="n">room_message</span><span class="p">.</span><span class="nf">message</span> <span class="cp">%&gt;</span>
                <span class="nt">&lt;/p&gt;</span>

                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-right"</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;small&gt;</span>
                    <span class="cp">&lt;%=</span> <span class="n">room_message</span><span class="p">.</span><span class="nf">created_at</span> <span class="cp">%&gt;</span>
                  <span class="nt">&lt;/small&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="cp">&lt;%=</span> <span class="n">simple_form_for</span> <span class="vi">@room_message</span><span class="p">,</span> <span class="ss">remote: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-group mb-3"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">input</span> <span class="ss">:message</span><span class="p">,</span> <span class="ss">as: :string</span><span class="p">,</span>
                                 <span class="ss">wrapper: </span><span class="kp">false</span><span class="p">,</span>
                                 <span class="ss">label: </span><span class="kp">false</span><span class="p">,</span>
                                 <span class="ss">input_html: </span><span class="p">{</span>
                                   <span class="ss">class: </span><span class="s1">'chat-input'</span>
                                 <span class="p">}</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-group-append"</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="s2">"Send"</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'btn btn-primary chat-input'</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">input</span> <span class="ss">:room_id</span><span class="p">,</span> <span class="ss">as: :hidden</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>και προσθέστε τις παρακάτω CSS κλάσεις <strong>μέσα στην κλάση .chat</strong>:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.chat-message-container</span> <span class="p">{</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>

  <span class="err">.avatar</span> <span class="err">{</span>
    <span class="nl">margin</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nc">.message-content</span> <span class="p">{</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="err">$</span><span class="n">primary</span><span class="p">;</span>
    <span class="nl">border-radius</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="nl">background</span><span class="p">:</span> <span class="n">lighten</span><span class="p">(</span><span class="err">$</span><span class="n">primary</span><span class="p">,</span> <span class="m">10%</span><span class="p">);</span>
    <span class="nl">color</span><span class="p">:</span> <span class="err">$</span><span class="no">white</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="o">&amp;</span> <span class="o">+</span> <span class="nc">.chat-message-container</span> <span class="p">{</span>
    <span class="nl">margin-top</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="err">}</span>
</code></pre></div></div>

<p>Φορτώστε ξανά τη σελίδα. Magic.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/16.png" alt="Improved display of room messages" /></p>

<h2 id="websockets---actioncable">WebSockets - ActionCable</h2>

<p>Ήρθε η ώρα να χρησιμοποιήσουμε τα WebSockets μέσω της λειτουργικότητας ActionCable του Rails.</p>

<blockquote>
  <p>Action Cable seamlessly integrates WebSockets with the rest of your Rails application. It allows for real-time features to be written in Ruby in the same style and form as the rest of your Rails application, while still being performant and scalable. It’s a full-stack offering that provides both a client-side JavaScript framework and a server-side Ruby framework. You have access to your full domain model written with Active Record or your ORM of choice.
<cite>– <a href="https://guides.rubyonrails.org/action_cable_overview.html">Action Cable Overview @ Ruby on Rails Guides (v5.2.3)</a></cite></p>
</blockquote>

<h3 id="εγκατάσταση-redis">Εγκατάσταση redis</h3>

<p>Θα χρησιμοποιήσουμε τον προσαρμογέα (adapter) <code class="highlighter-rouge">redis</code> που αποτελεί <a href="https://guides.rubyonrails.org/action_cable_overview.html#redis-adapter">μια ασφαλή επιλογή για παραγωγικά περιβάλλοντα</a> σε αντίθεση με την επιλογή <code class="highlighter-rouge">async</code>.</p>

<p>Πρώτα πρέπει να εγκαταστήσετε την εφαρμογή <a href="https://redis.io/">redis</a> στο σύστημά σας.</p>

<p>Για να το εγκαταστήσω σε Ubuntu χρειάστηκε απλά να εκτελέσω τις παρακάτω εντολές.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>redis-server
</code></pre></div></div>

<p>Για να ελέγξετε ότι η εγκατάσταση ήταν επιτυχής, βεβαιωθείτε ότι παίρνετε PONG όταν εκτελείτε:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ redis-cli
127.0.0.1:6379&gt; ping
PONG
</code></pre></div></div>

<h3 id="ρύθμιση-του-actioncable">Ρύθμιση του ActionCable</h3>

<p>Αφου εργαζόμαστε σε περιβάλλον ανάπτυξης (development environment), ανοίξτε το αρχείο ρυθμίσεων του στοιχείου ActionCable <code class="highlighter-rouge">config/cable.yml</code> και αντικαταστήστε τα περιεχόμενά του με τα παρακάτω:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">redis</span>
  <span class="na">url</span><span class="pi">:</span> <span class="s">&lt;%= ENV.fetch("REDIS_URL") { "redis://localhost:6379/1" } %&gt;</span>
  <span class="na">channel_prefix</span><span class="pi">:</span> <span class="s">rails-chat-tutorial_development</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">async</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">redis</span>
  <span class="na">url</span><span class="pi">:</span> <span class="s">&lt;%= ENV.fetch("REDIS_URL") { "redis://localhost:6379/1" } %&gt;</span>
  <span class="na">channel_prefix</span><span class="pi">:</span> <span class="s">rails-chat-tutorial_production</span>
</code></pre></div></div>

<p><strong>Σημείωση:</strong> προσθέσαμε την επιλογή <code class="highlighter-rouge">channel_prefix</code> επειδή:</p>

<blockquote>
  <p>Additionally, a channel_prefix may be provided to avoid channel name collisions when using the same Redis server for multiple applications
<cite>– <a href="https://guides.rubyonrails.org/action_cable_overview.html#redis-adapter">Action Cable Overview # Redis Adapter @ Ruby on Rails Guides (v5.2.3)</a></cite></p>
</blockquote>

<p>Τέλος, θα προσθέσουμε την απαίτηση βιβλιοθήκης για τον προσαρμογέα <code class="highlighter-rouge">redis</code> στο μητρώο απαιτήσεων <code class="highlighter-rouge">Gemfile</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'redis'</span>
</code></pre></div></div>

<p>Μην ξεχνάτε να εκτελείτε <code class="highlighter-rouge">bundle</code> κάθε φορά που αλλάζετε αυτό το αρχείο.</p>

<h3 id="ρύθμιση-devise-για-πιστοποίηση-συνδέσεων-websocket">Ρύθμιση <code class="highlighter-rouge">devise</code> για πιστοποίηση συνδέσεων WebSocket</h3>

<p>Όταν εγκαθίσταται μια σύνδεση WebSocket, δεν έχουμε πρόσβαση στη συνεδρία του χρήστη (user session) αλλά έχουμε πρόσβαση τα cookies του. Έτσι, για να μπορούμε να πιστοποιήσουμε τον χρήστη χρειάζεται να κάνουμε κάποια πράγματα σχετικά με το <code class="highlighter-rouge">devise</code> (<a href="https://rubytutorial.io/actioncable-devise-authentication/">credits to Greg Molnar</a>).</p>

<p>Δημιουργήστε έναν αρχικοποιητή για τα “warden hooks” με το όνομα <code class="highlighter-rouge">config/initializers/warden_hooks.rb</code> και προσθέστε τις παρακάτω γραμμές:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Warden</span><span class="o">::</span><span class="no">Manager</span><span class="p">.</span><span class="nf">after_set_user</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span><span class="n">auth</span><span class="p">,</span><span class="n">opts</span><span class="o">|</span>
  <span class="n">scope</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="ss">:scope</span><span class="p">]</span>
  <span class="n">auth</span><span class="p">.</span><span class="nf">cookies</span><span class="p">.</span><span class="nf">signed</span><span class="p">[</span><span class="s2">"</span><span class="si">#{</span><span class="n">scope</span><span class="si">}</span><span class="s2">.id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">id</span>
<span class="k">end</span>

<span class="no">Warden</span><span class="o">::</span><span class="no">Manager</span><span class="p">.</span><span class="nf">before_logout</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">auth</span><span class="p">,</span> <span class="n">opts</span><span class="o">|</span>
  <span class="n">scope</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="ss">:scope</span><span class="p">]</span>
  <span class="n">auth</span><span class="p">.</span><span class="nf">cookies</span><span class="p">.</span><span class="nf">signed</span><span class="p">[</span><span class="s2">"</span><span class="si">#{</span><span class="n">scope</span><span class="si">}</span><span class="s2">.id"</span><span class="p">]</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Επεξήγηση:</strong> Προσθέτουμε ένα cookie με το αναγνωριστικό του χρήστη (user id) μετά την επιτυχή πιστοποίηση του και το αφαιρούμε κατά την έξοδό του από την εφαρμογή.</p>

<h3 id="ρύθμιση-της-σύνδεση-websocket">Ρύθμιση της σύνδεση WebSocket</h3>

<p>Ανοίξτε το αρχείο <code class="highlighter-rouge">app/channels/application_cable/connection.rb</code> και αλλάξτε τα περιεχόμενά του ως εξής:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">ApplicationCable</span>
  <span class="k">class</span> <span class="nc">Connection</span> <span class="o">&lt;</span> <span class="no">ActionCable</span><span class="o">::</span><span class="no">Connection</span><span class="o">::</span><span class="no">Base</span>
    <span class="n">identified_by</span> <span class="ss">:current_user</span>

    <span class="k">def</span> <span class="nf">connect</span>
      <span class="nb">self</span><span class="p">.</span><span class="nf">current_user</span> <span class="o">=</span> <span class="n">find_verified_user</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">find_verified_user</span>
      <span class="k">if</span> <span class="n">verified_user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">id: </span><span class="n">cookies</span><span class="p">.</span><span class="nf">signed</span><span class="p">[</span><span class="s1">'user.id'</span><span class="p">])</span>
        <span class="n">verified_user</span>
      <span class="k">else</span>
        <span class="n">reject_unauthorized_connection</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Επεξήγηση:</strong></p>

<blockquote>
  <p>Here identified_by is a connection identifier that can be used to find the specific connection later. Note that anything marked as an identifier will automatically create a delegate by the same name on any channel instances created off the connection.
<cite>– <a href="https://guides.rubyonrails.org/action_cable_overview.html#connection-setup">Action Cable Overview # Connection setup @ Ruby on Rails Guides (v5.2.3)</a></cite></p>
</blockquote>

<p>Στη μέθοδο <code class="highlighter-rouge">find_verified_user</code> προσπελαύνουμε το cookie που θέσαμε νωρίτερα στον αρχικοποιητή των <code class="highlighter-rouge">warden hooks</code>.</p>

<h3 id="δημιουργία-του-καναλιού-δωματίου">Δημιουργία του καναλιού δωματίου</h3>

<blockquote>
  <p>A channel encapsulates a logical unit of work, similar to what a controller does in a regular MVC setup.
<cite>– <a href="https://guides.rubyonrails.org/action_cable_overview.html#channelsp">Action Cable Overview # Channels @ Ruby on Rails Guides (v5.2.3)</a></cite></p>
</blockquote>

<p>Θα δημιουργήσουμε το κανάλι <code class="highlighter-rouge">RoomChannel</code> στο οποίο θα εγγράφονται όλες οι σελίδες δωματίων.</p>

<p>Δημιουργήστε το κανάλι με το όνομα <code class="highlighter-rouge">app/channels/room_channel.rb</code> και τα εξής περιεχόμενα:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RoomChannel</span> <span class="o">&lt;</span> <span class="no">ApplicationCable</span><span class="o">::</span><span class="no">Channel</span>
  <span class="k">def</span> <span class="nf">subscribed</span>
    <span class="n">room</span> <span class="o">=</span> <span class="no">Room</span><span class="p">.</span><span class="nf">find</span> <span class="n">params</span><span class="p">[</span><span class="ss">:room</span><span class="p">]</span>
    <span class="n">stream_for</span> <span class="n">room</span>

    <span class="c1"># or</span>
    <span class="c1"># stream_from "room_#{params[:room]}"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Επεξήγηση</strong>:</p>

<ul>
  <li>Η μέθοδος <code class="highlighter-rouge">subscribed</code> εκτελείται κάθε φορά που εγγράφεται κάποιος στο κανάλι και είναι υπεύθυνη να ρυθμίσει τη ροή μέσω της οποίας τα δεδομένα θα πηγαινοέρχονται.</li>
</ul>

<p>Θα ρυθμίσουμε τον κώδικα της σελίδα δωματίου αργότερα με τέτοιο τρόπο ώστε κατά την εγγραφή στο κανάλι να αποστέλλεται και η παράμετρος του δωματίου <code class="highlighter-rouge">room</code>.</p>

<p>Έχουμε δύο επιλογές:</p>

<ul>
  <li>Να χρησιμοποιήσουμε τη μέθοδο <code class="highlighter-rouge">stream_for</code>: με αυτό τον τρόπο το Rails αυτόματα παράγει ένα όνομα ροής για το εκάστοτε μοντέλο (<code class="highlighter-rouge">room</code> στην περίπτωσή μας), για παράδειγμα: “room:asdfwer234”. Όταν στη συνέχεια θέλουμε να στείλουμε δεδομένα σε αυτή τη ροή, το μόνο που έχουμε να κάνουμε είναι να εκτελέσουμε τη μέθοδο <code class="highlighter-rouge">RoomChannel.broadcast_to(room_object, data)</code> όπου το Rails θα ανακτήσει αυτόματα το όνομα της ροής βάσει της παραμέτρου <code class="highlighter-rouge">room_object</code>. Με άλλα λόγια, δε χρειάζεται εμείς να υπολογίζουμε το όνομα μιας ροής δωματίου στην οποία θέλουμε να στείλουμε/λάβουμε δεδομένα.
    <ul>
      <li>αυτή η επιλογή είναι μόνο όταν το κανάλι χειρίζεται εγγραφές (subscriptions) που συνδέονται με μοντέλα, στην περίπτωσή μας κάποιο δωμάτιο</li>
    </ul>
  </li>
  <li>Να χρησιμοποιήσουμε τη μέθοδο <code class="highlighter-rouge">stream_from</code>: ορίζουμε μόνοι μας το όνομα της ροής και στη συνέχεια, όταν θέλουμε να στείλουμε δεδομένα στη ροή χρησιμοποιούμε: <code class="highlighter-rouge">ActionCable.server.broadcast("room_#{a_room_id_here}", data)</code>.</li>
</ul>

<p>Διαβάστε περισσότερα <a href="https://guides.rubyonrails.org/action_cable_overview.html#streams">εδώ</a>.</p>

<h3 id="αναμετάδοση-μηνυμάτων">Αναμετάδοση μηνυμάτων</h3>

<p>Κάθε φορά που δημιουργείται ένα μήνυμα, θέλουμε να το αναμεταδώσουμε στη ροή του καναλιού για το συγκεκριμένο δωμάτιο.
Για να το κάνουμε αυτό, αλλάξτε την ενέργεια δημιουργίας μηνύματος - <code class="highlighter-rouge">create</code> του αντίστοιχου ελεγκτή <code class="highlighter-rouge">app/controllers/room_messages_controller.rb</code> ως εξής:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@room_message</span> <span class="o">=</span> <span class="no">RoomMessage</span><span class="p">.</span><span class="nf">create</span> <span class="ss">user: </span><span class="n">current_user</span><span class="p">,</span>
                                     <span class="ss">room: </span><span class="vi">@room</span><span class="p">,</span>
                                     <span class="ss">message: </span><span class="n">params</span><span class="p">.</span><span class="nf">dig</span><span class="p">(</span><span class="ss">:room_message</span><span class="p">,</span> <span class="ss">:message</span><span class="p">)</span>

  <span class="no">RoomChannel</span><span class="p">.</span><span class="nf">broadcast_to</span> <span class="vi">@room</span><span class="p">,</span> <span class="vi">@room_message</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Επεξήγηση</strong>: προσθέσαμε τη γραμμή <code class="highlighter-rouge">RoomChannel.broadcast_to @room, @room_message</code> που θα αναμεταδώσει στη ροή του καναλιού του δωματίου (όπως εξηγήσαμε προηγουμένως) το μήνυμα <code class="highlighter-rouge">@room_message</code> μετασχηματισμένο σε μορφή JSON μέσω της μεθόδου <code class="highlighter-rouge">to_json</code>.</p>

<p>Έτσι, στην άλλη πλευρά, στην πλευρά του πελάτη δηλαδή, θα παραλάβουμε την JSON μορφή του μοντέλου <code class="highlighter-rouge">RoomMessage</code>. Για να δούμε πως είναι αυτή:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">29</span><span class="p">,</span><span class="w">
  </span><span class="nl">"room_id"</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="w">
  </span><span class="nl">"user_id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="s2">"My first message"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_at"</span><span class="p">:</span><span class="s2">"2019-04-04T17:09:00.637Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="s2">"2019-04-04T17:09:00.637Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Έχουμε σκοπό να εμφανίσουμε τα μηνύματα στη σελίδα του δωματίου μέσω Javascript και αυτή η πληροφορία που λαμβάνουμε προς το παρόν δεν είναι αρκετή. Μας λείπει η διεύθυνση της εικόνας προφίλ <code class="highlighter-rouge">gravatar</code>. Ας την προσθέσουμε.</p>

<p>Ανοίξτε το μοντέλου του χρήστη <code class="highlighter-rouge">app/models/user.rb</code> και προσθέστε την παρακάτω μέθοδο.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def gravatar_url
  gravatar_id = Digest::MD5::hexdigest(email).downcase
  "https://gravatar.com/avatar/#{gravatar_id}.png"
end
</code></pre></div></div>

<p>Έχουμε ήδη υλοποιήσει αυτή τη μέθοδο στις βοηθητικές μεθόδους <code class="highlighter-rouge">app/helpers/application_helper.rb</code> αλλά δε θα τη χρειαστούμε πλέον οπότε <strong>αφαιρέστε τη</strong>.</p>

<p>Ενημερώστε το απόσπασμα της μπάρας πλοήγησης <code class="highlighter-rouge">app/views/shared/_navigation_bar.html.erb</code> ώστε ο υπολογισμός της διεύθυνσης της εικόνας προφίλ να γίνεται πλέον από τη μέθοδο που μόλις δημιουργήσαμε:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"avatar"</span> <span class="na">src=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">current_user</span><span class="p">.</span><span class="nf">gravatar_url</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>Ενημερώστε και τη σελίδα δωματίου <code class="highlighter-rouge">app/views/rooms/show.html.erb</code> αλλάξτε τη και εκεί επίσης, με:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">room_message</span><span class="p">.</span><span class="nf">user</span><span class="p">.</span><span class="nf">gravatar_url</span> <span class="cp">%&gt;</span><span class="s">"</span> <span class="na">class=</span><span class="s">"avatar"</span> <span class="na">alt=</span><span class="s">""</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>Τέλος, θα αλλάξουμε το μετασχηματισμό <code class="highlighter-rouge">JSON</code> των μηνυμάτων - <code class="highlighter-rouge">RoomMessage</code> ώστε να εμπεριέχει και τη διεύθυνση της εικόνας προφίλ:</p>

<p><em>app/models/room_message.rb</em></p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">as_json</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
  <span class="k">super</span><span class="p">(</span><span class="n">options</span><span class="p">).</span><span class="nf">merge</span><span class="p">(</span><span class="ss">user_avatar_url: </span><span class="n">user</span><span class="p">.</span><span class="nf">gravatar_url</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Ας επιβεβαιώσουμε ότι ο μετασχηματισμός είναι επιτυχής:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">29</span><span class="p">,</span><span class="w">
  </span><span class="nl">"room_id"</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="w">
  </span><span class="nl">"user_id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="s2">"My first message"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_at"</span><span class="p">:</span><span class="s2">"2019-04-04T17:09:00.637Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="s2">"2019-04-04T17:09:00.637Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"user_avatar_url"</span><span class="p">:</span><span class="s2">"https://gravatar.com/avatar/02a28db6886d578f75a820b50f2dd334.png"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Μια χαρά, προχωράμε.</p>

<h3 id="εγγραφή-στη-ροή-δωματίου">Εγγραφή στη ροή δωματίου</h3>

<p>Θα προσθέσουμε κάποια δεδομένα στη σελίδα των δωματίων ώστε να μπορούμε να τα χρησιμοποιήσουμε μέσω Javascript για να πραγματοποιούμε εγγραφή στις κατάλληλες ροές κάθε φορά που επισκεπτόμαστε ένα δωμάτιο.</p>

<p>Ανοίξτε το αρχείο <code class="highlighter-rouge">app/views/rooms/show.html.erb</code> και αλλάξτε τη γραμμή στην οποία ορίζουμε το div <code class="highlighter-rouge">chat</code> ως εξής:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"chat"</span> <span class="na">data-channel-subscribe=</span><span class="s">"room"</span> <span class="na">data-room-id=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="vi">@room</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p><strong>Επεξήγηση</strong>: Προσθέσαμε δύο χαρακτηριστικά δεδομένων, ένα που ορίζει σε ποιο κανάλι θέλουμε να γραφτούμε (<code class="highlighter-rouge">room</code>) και ένα που ορίζει σε ποιο συγκεκριμένο δωμάτιο βρισκόμαστε (<code class="highlighter-rouge">@room.id</code>).</p>

<p>Στο τέλος του αρχείου προσθέστε το παρακάτω απόσπασμα κώδικα:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-none"</span> <span class="na">data-role=</span><span class="s">"message-template"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"chat-message-container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row no-gutters"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-auto text-center"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">""</span> <span class="na">class=</span><span class="s">"avatar"</span> <span class="na">alt=</span><span class="s">""</span> <span class="na">data-role=</span><span class="s">"user-avatar"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"message-content"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"mb-1"</span> <span class="na">data-role=</span><span class="s">"message-text"</span><span class="nt">&gt;&lt;/p&gt;</span>

          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-right"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;small</span> <span class="na">data-role=</span><span class="s">"message-date"</span><span class="nt">&gt;&lt;/small&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Αυτό το απόσπασμα θα χρησιμοποιείται σαν πρότυπο (template) για κάθε εισερχόμενο μήνυμα. Κάθε φορά που έρχεται κάποιο μήνυμα θα:</p>

<ul>
  <li>κλωνοποιούμε αυτό το απόσπασμα HTML</li>
  <li>θα αλλάζουμε τις τιμές των κατάλληλων στοιχείων του κλωνοποιημένου πλέον αποσπάσματος και τέλος</li>
  <li>θα προσαρτούμε τον παραγόμενο HTML κώδικα στο τέλος του div <code class="highlighter-rouge">chat</code>.</li>
</ul>

<p>Τώρα θα δημιουργήσουμε το Javascript που θα είναι υπεύθυνο για τις εγγραφές στις ροές των καναλιών και για τον χειρισμό των εισερχόμενων δεδομένων.</p>

<p>Δημιουργήστε το αρχείο <code class="highlighter-rouge">app/assets/javascripts/channels/room_channel.js</code> και προσθέστε τον παρακάτω κώδικα:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-channel-subscribe="room"]</span><span class="dl">'</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">),</span>
        <span class="nx">room_id</span> <span class="o">=</span> <span class="nx">$element</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="dl">'</span><span class="s1">room-id</span><span class="dl">'</span><span class="p">)</span>
        <span class="nx">messageTemplate</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-role="message-template"]</span><span class="dl">'</span><span class="p">);</span>

    <span class="nx">$element</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="na">scrollTop</span><span class="p">:</span> <span class="nx">$element</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="dl">"</span><span class="s2">scrollHeight</span><span class="dl">"</span><span class="p">)},</span> <span class="mi">1000</span><span class="p">)</span>        

    <span class="nx">App</span><span class="p">.</span><span class="nx">cable</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">RoomChannel</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">room</span><span class="p">:</span> <span class="nx">room_id</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">received</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">messageTemplate</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">clone</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
          <span class="nx">content</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-role="user-avatar"]</span><span class="dl">'</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">'</span><span class="s1">src</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">user_avatar_url</span><span class="p">);</span>
          <span class="nx">content</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-role="message-text"]</span><span class="dl">'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
          <span class="nx">content</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-role="message-date"]</span><span class="dl">'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">updated_at</span><span class="p">);</span>
          <span class="nx">$element</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
          <span class="nx">$element</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="na">scrollTop</span><span class="p">:</span> <span class="nx">$element</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="dl">"</span><span class="s2">scrollHeight</span><span class="dl">"</span><span class="p">)},</span> <span class="mi">1000</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p><strong>Επεξήγηση</strong>:</p>

<ul>
  <li>Για κάθε στοιχείο που έχει χαρακτηριστικό δεδομένων (data attribute) <code class="highlighter-rouge">channel-subscribe</code> με τιμή <code class="highlighter-rouge">room</code>
    <ul>
      <li>Δημιούργησε μια εγγραφή (subscription) στο κανάλι “RoomChannel” περνώντας ως παράμετρο με όνομα <code class="highlighter-rouge">room</code> την τιμή του <code class="highlighter-rouge">room-id</code> χαρακτηριστικού δεδομένων (θυμηθείτε αυτή τη γραμμή στο κανάλι των δωματίων (<code class="highlighter-rouge">RoomChannel</code>): <code class="highlighter-rouge">Room.find params[:room]</code>)
        <ul>
          <li>Όταν έρχονται δεδομένα, κλωνοποίησε το πρότυπο και άλλαξε τα περιεχόμενά του βάσει των χαρακτηριστικών του εισερχόμενου αντικειμένου.</li>
          <li>Πρόσθεσε το νέο περιεχόμενο στο div <code class="highlighter-rouge">chat</code> και τέλος</li>
          <li>Χρησιμοποίησε animation για να εντυπωσιάσεις τους χρήστες μετακινώντας σταδιακά την τρέχουσα θέση του div μηνυμάτων στο κάτω μέρος του (αν δεν έγινε κατανοητό στα ελληνικά, εννοώ να γίνει smooth scrolling στο bottom του div :).</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>Αυτάααααααα! Μεγάλο άρθρο, κουράστηκε η γάτα.</p>

<p><img src="https://iridakos.com/assets/images/posts/rails-chat-tutorial/irida.jpg" alt="Tired cat photo" /></p>

<h2 id="ευχαριστίες">Ευχαριστίες</h2>

<p>Ευχαριστώ πολύ για τα σχόλια και το feedback!</p>

<ul>
  <li>[1] Armando Andini - <a href="https://github.com/iridakos/rails-chat-tutorial/issues/3">N+1 queries</a></li>
  <li>[2] Rodolfo Ruiz - <a href="https://github.com/iridakos/rails-chat-tutorial/issues/5">Coffeescript leftovers</a></li>
  <li>[3] Felix Wolfsteller - <a href="https://github.com/iridakos/rails-chat-tutorial/issues/1">Turbolinks leftovers</a></li>
  <li>[4] Maria Kravtsova - <a href="https://github.com/iridakos/rails-chat-tutorial/issues/2">Migration typo</a></li>
  <li>[5][7][8] Tony Dehnke - <a href="https://github.com/iridakos/rails-chat-tutorial/issues/6">Sign up step</a>, <a href="https://github.com/iridakos/rails-chat-tutorial/issues/8">Missing step for adding model relations</a>, <a href="https://github.com/iridakos/rails-chat-tutorial/issues/7">Missing line from html code block</a></li>
  <li>[6] keytonw - <a href="https://github.com/iridakos/rails-chat-tutorial/issues/9">Devise view missing button class</a></li>
  <li>[9] Martin - <a href="https://github.com/iridakos/rails-chat-tutorial/issues/11">Mention order of requirements in application.js</a></li>
  <li>[10] Sumak - <a href="https://github.com/iridakos/rails-chat-tutorial/issues/15">Remove duplicate authentication related code</a></li>
</ul>

                </div>
              </div>

              <div class="col-12 order-first">
                <div class="d-sm-block d-md-none mb-3">
                  <a class=" btn btn-outline-primary d-block collapsed text-left"
                    title="View the structure of this document"
                    role="button"
                    data-toggle="collapse"
                    data-role="outline"
                    data-content=".outline"
                    href="#docout-mobile"
                    data-target="#docout-mobile"
                    aria-expanded="false"
                    aria-controls="collapse">
                    Πίνακας περιεχομένων
                    <i class="fa iridakos-collapse pull-right mt-1"></i>
                  </a>

                  <div id="docout-mobile" class="collapse my-3 border rounded bg-light p-2">
                  </div>
                </div>
              </div>
            </div>
          

          <!--googleoff: index-->







<div class="post-navigation">
  <div class="row">
    <div class="col-12 col-md-4 my-3">
      
        <a class="d-block btn btn-light btn-sm" href="/el/programming/2019/11/13/bash-programmable-completion-tutorial" title="Bash: Προσθέτοντας tab συμπλήρωση στα script">
          <strong>
            <i class="fa fa-angle-double-left"></i> προηγούμενο άρθρο
          </strong>

          <hr class="my-1">

          <small>
            Bash: Προσθέτοντας tab συμπλήρωση στα script
          </small>
        </a>
      
    </div>

    <div class="col-12 col-md-4 offset-md-4 my-3">
      
        <a class="d-block btn btn-light btn-sm" href="/el/programming/2019/11/22/i" title="i">
          <strong>
            επόμενο άρθρο <i class="fa fa-angle-double-right"></i>
          </strong>

          <hr class="my-1">

          <small>
            i
          </small>
        </a>
      
    </div>
  </div>
</div>


<!--googleon: index-->

          


  
    <div class="alert alert-light related-posts">
      <h4 class="alert-heading"><i class="fa fa-hand-spock-o" aria-hidden="true"></i> Το πιο πρόσφατο άρθρο</h4>

      <div class="row mt-3">
        <div class="col">
          <a class="alert-link"
             href="/el/programming/2020/02/10/shell-palindrome-dates"><strong>Εύρεση παλίνδρομων ημερομηνιών στην Linux κονσόλα - επεξήγηση</strong></a>
          <div>
            <small>Ένα άρθρο που εξηγεί πως μπορείτε να βρείτε παλίνδρομες ημερομηνίες χρησιμοποιώντας εντολές στο φλοιό του Linux</small>
          </div>
        </div>
      </div>
    </div>
  


          
<div class="alert alert-light related-posts">
  <h4 class="alert-heading"><i class="fa fa-hand-o-right" aria-hidden="true"></i> Σχετικά άρθρα</h4>

  

  <ul class="list-unstyled">
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
    
      
    
      
        <li>
          <a class="alert-link" href="/el/programming/2019/11/13/bash-programmable-completion-tutorial"><strong>Bash: Προσθέτοντας tab συμπλήρωση στα script</strong></a>
          <div>
            <small>Ένα βοήθημα σχετικά με το πως μπορείτε να προσθέσετε tab συμπλήρωση στα script σας σε περιβάλλον Bash</small>
          </div>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
  </ul>
</div>


          
<div class="share-links">
  <a class="btn btn-warning" href="https://twitter.com/intent/tweet?text=Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets&url=https://iridakos.com/el/programming/2019/11/19/creating-chat-application-rails-websockets" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter"></i></a>
  <a class="btn btn-warning" href="https://facebook.com/sharer.php?u=https://iridakos.com/el/programming/2019/11/19/creating-chat-application-rails-websockets" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook"></i></a>
  <a class="btn btn-warning" href="https://www.reddit.com/submit" onclick="window.location = 'https://www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false" title="Share on Reddit"><i class="fa fa-reddit"></i></a>
  <a class="btn btn-warning" href="mailto:?subject=Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets&amp;body=Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets: https://iridakos.com/el/programming/2019/11/19/creating-chat-application-rails-websockets"><i class="fa fa-envelope-o" title="Share with email"></i></a>
</div>

<div class="subscribe-links">
  <button class="btn btn-warning btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <i class="fa fa-rss"></i> RSS feeds
  </button>

  <div class="dropdown-menu dropdown-menu-right">
    <a class="dropdown-item" href="/el/feed.xml">όλα τα άρθρα</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item" href="/el/feeds/programming.xml">όλα τα άρθρα προγραμματισμού</a>
    <a class="dropdown-item" href="/el/feeds/tutorials.xml">βοηθήματα προγραμματισμού</a>
    <a class="dropdown-item" href="/el/feeds/opensource.xml">άρθρα σχετικά με ανοιχτό λογισμικό</a>
    <a class="dropdown-item" href="/el/feeds/ruby.xml">άρθρα σχετικά με την Ruby (...on Rails)</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item" href="/el/feeds/programming-humor.xml">Χιούμορ για προγραμματιστές</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item" href="/el/feeds/painting.xml">άρθρα ζωγραφικής</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item" href="/el/feeds/cats.xml">άρθρα με γάτες</a>
  </div>
</div>

        </div>

        <div class="col">
          <div class="sidebar">
  
    <div class="alert alert-primary d-none d-md-block">
      <div class="sidebar-section">
        <a class="btn btn-warning d-block collapsed text-left"
          data-toggle="collapse"
          data-role="outline"
          data-content=".outline"
          href="#docout-sidebar"
          data-target="#docout-sidebar"

          title="View the structure of this document"
          role="button"
          href="#docout-sidebar"
          aria-expanded="false"
          aria-controls="collapse">
          Πίνακας περιεχομένων
          <i class="fa iridakos-collapse pull-right mt-1"></i>
        </a>

        <div class="section-content">
          <div id="docout-sidebar" class="collapse mt-2 p-2">

          </div>
        </div>
      </div>
    </div>
  

  

  <div class="alert alert-primary">
  <div class="sidebar-section">
    <div class="section-title">
      <h4><i class="fa fa-hand-spock-o"></i> Δημοφιλή άρθρα</h4>
    </div>

    <div class="section-content">
      
      
        
          <div class="section-item">
            <div class="float-right ml-1">
              
                <span class="featured-hacker-news" title="Featured in Hacker News" data-toggle="tooltip"><i class="fa fa-hacker-news"></i></span>
              
                <span class="featured-opensource-com" title="Featured in opensource.com" data-toggle="tooltip"><i class="fa fa-linux"></i></span>
              
                <span class="featured-hackernewsletter" title="Featured in hackernewsletter" data-toggle="tooltip"><i class="fa fa-envelope"></i></span>
              
            </div>
            <a href="/el/programming/2019/11/13/bash-programmable-completion-tutorial">Bash: Προσθέτοντας tab συμπλήρωση στα script</a>
             <div class="text-muted smaller">
               Ένα βοήθημα σχετικά με το πως μπορείτε να προσθέσετε tab συμπλήρωση στα script σας σε περιβάλλον Bash
             </div>
          </div>
        
      
        
          <div class="section-item">
            <div class="float-right ml-1">
              
                <span class="featured-farnam-street" title="Featured in Farnam Street" data-toggle="tooltip">fs <i class="fa fa-envelope"></i></span>
              
                <span class="featured-hacker-news" title="Featured in Hacker News" data-toggle="tooltip"><i class="fa fa-hacker-news"></i></span>
              
                <span class="featured-betterldevlink" title="Featured in Better Dev Link" data-toggle="tooltip"><i class="fa fa-envelope"></i></span>
              
            </div>
            <a href="/el/programming/2019/11/11/composing-better-emails">Γράφοντας καλύτερα email</a>
             <div class="text-muted smaller">
               Ηλεκτρονική αλληλογραφία - Συμβουλές για την σύνταξη αποτελεσματικών email αποφεύγοντας παρανοήσεις, με παραδείγματα από τον κόσμο της πληροφορικής.
             </div>
          </div>
        
      
        
          <div class="section-item">
            <div class="float-right ml-1">
              
                <span class="featured-hacker-news" title="Featured in Hacker News" data-toggle="tooltip"><i class="fa fa-hacker-news"></i></span>
              
                <span class="featured-hackernewsletter" title="Featured in hackernewsletter" data-toggle="tooltip"><i class="fa fa-envelope"></i></span>
              
                <span class="featured-opensource-com" title="Featured in opensource.com" data-toggle="tooltip"><i class="fa fa-linux"></i></span>
              
            </div>
            <a href="/el/programming/2019/11/11/remove-duplicate-lines-preserving-order-linux">Αποδιπλοποίηση των γραμμών ενός αρχείου διατηρώντας τη σειρά τους</a>
             <div class="text-muted smaller">
               Πως να αφαιρέσετε τις διπλές γραμμές ενός αρχείο σε Linux χωρίς να αλλάξει η σειρά τους - επεξήγηση awk one-liner κώδικα.
             </div>
          </div>
        
      
        
          <div class="section-item">
            <div class="float-right ml-1">
              
                <span class="featured-ruby-weekly" title="Featured in Ruby Weekly" data-toggle="tooltip"><i class="fa fa-diamond"></i></span>
              
            </div>
            <a href="/el/programming/2019/11/19/creating-chat-application-rails-websockets">Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets</a>
             <div class="text-muted smaller">
               Ένα βοήθημα που περιγράφει βήμα προς βήμα πως να δημιουργήσετε μια εφαρμογή συνομιλιών (chat) από το μηδέν με χρήση Rails και WebSockets (ActionCable).
             </div>
          </div>
        
      

      <div class="section-item">
        <a href="/el/programming/featured">Δείτε όλα τα δημοφιλή άρθρα</a>
      </div>
    </div>
  </div>
</div>


  
<div class="alert alert-primary">
  <div class="sidebar-section">
    <div class="section-title">
      <h4><i class="fa fa-bullhorn"></i> Πρόσφατα άρθρα</h4>
    </div>

    

    <div class="section-content">
      
          <div class="section-item">
            <a href="/el/programming/2020/02/10/shell-palindrome-dates">Εύρεση παλίνδρομων ημερομηνιών στην Linux κονσόλα - επεξήγηση</a>
            <div class="text-muted smaller">Ένα άρθρο που εξηγεί πως μπορείτε να βρείτε παλίνδρομες ημερομηνίες χρησιμοποιώντας εντολές στο φλοιό του Linux</div>
          </div>
      
          <div class="section-item">
            <a href="/el/programming/2019/12/12/descriptive-variable-names">Περιγραφική ονομασία μεταβλητών</a>
            <div class="text-muted smaller">Βοήθεια βοήθεια βοήθεια</div>
          </div>
      
          <div class="section-item">
            <a href="/el/cats/2019/12/06/movie-night">Βραδιά ταινίας</a>
            <div class="text-muted smaller">Παρακολουθώντας ταινίες θρίλερ με το γατί</div>
          </div>
      
    </div>
  </div>
</div>



  <div class="alert alert-primary">
  <div class="sidebar-section">
    <div class="section-title">
      <h4>
        <i class="fa fa-github"></i> Κώδικας
      </h4>

      <div class="float-right">

      </div>
    </div>

    <div class="section-content">
      <div class="section-item">
        <a href="https://github.com/iridakos/goto">goto</a>: ένα utility για καταχώρηση ψευδώνυμων φακέλων και πλοήγηση σε αυτούς με bash completion
      </div>

      <div class="section-item">
        <a href="https://github.com/iridakos/elman">elman</a>: ένα script για ευρετηριασμένη αναζήτηση στις Linux βοηθητικές σελίδες με χρήση του Elasticsearch
      </div>

      <div class="section-item">
        <a href="https://github.com/iridakos/duckrails">DuckRails</a>
        Η έκδοση <span class="important">2.1.5</span> είναι διαθέσιμη <img src="/assets/images/news/duckrails.png" class="logo" /> (<a href="https://github.com/iridakos/duckrails/wiki/Setup-DuckRails-via-Docker" target="_blank">docker image διαθέσιμο επίσης</a>)
      </div>
    </div>
  </div>
</div>


  


  
    <div class="alert alert-primary d-none d-md-block">
      <div class="sidebar-section">
        <div class="section-content mt-2">
          
<div class="share-links">
  <a class="btn btn-warning" href="https://twitter.com/intent/tweet?text=Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets&url=https://iridakos.com/el/programming/2019/11/19/creating-chat-application-rails-websockets" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter"></i></a>
  <a class="btn btn-warning" href="https://facebook.com/sharer.php?u=https://iridakos.com/el/programming/2019/11/19/creating-chat-application-rails-websockets" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook"></i></a>
  <a class="btn btn-warning" href="https://www.reddit.com/submit" onclick="window.location = 'https://www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false" title="Share on Reddit"><i class="fa fa-reddit"></i></a>
  <a class="btn btn-warning" href="mailto:?subject=Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets&amp;body=Δημιουργώντας μια εφαρμογή συνομιλιών (chat) από το μηδέν με Rails και WebSockets: https://iridakos.com/el/programming/2019/11/19/creating-chat-application-rails-websockets"><i class="fa fa-envelope-o" title="Share with email"></i></a>
</div>

<div class="subscribe-links">
  <button class="btn btn-warning btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <i class="fa fa-rss"></i> RSS feeds
  </button>

  <div class="dropdown-menu dropdown-menu-right">
    <a class="dropdown-item" href="/el/feed.xml">όλα τα άρθρα</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item" href="/el/feeds/programming.xml">όλα τα άρθρα προγραμματισμού</a>
    <a class="dropdown-item" href="/el/feeds/tutorials.xml">βοηθήματα προγραμματισμού</a>
    <a class="dropdown-item" href="/el/feeds/opensource.xml">άρθρα σχετικά με ανοιχτό λογισμικό</a>
    <a class="dropdown-item" href="/el/feeds/ruby.xml">άρθρα σχετικά με την Ruby (...on Rails)</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item" href="/el/feeds/programming-humor.xml">Χιούμορ για προγραμματιστές</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item" href="/el/feeds/painting.xml">άρθρα ζωγραφικής</a>
    <div role="separator" class="dropdown-divider"></div>
    <a class="dropdown-item" href="/el/feeds/cats.xml">άρθρα με γάτες</a>
  </div>
</div>

        </div>
      </div>
    </div>
  
</div>

        </div>
      </div>
    </div>


    <div class="modal fade" id="image-modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">iridakos images preview</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <div class="modal-body text-center">
                <div class="image-container">
                    <img class="image" />
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <footer class="footer">
  <div class="container-fluid no-gutters">
    <div class="row">
      <div class="col-12">
        <hr>
      </div>
    </div>
    <div class="row">
      <div class="col-12 col-md-6">
        <div class="brand mb-1">
          <a href="https://iridakos.com">iridakos</a>
        </div>

        <div class="license">
          <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">iridakos</span> by
          <a xmlns:cc="http://creativecommons.org/ns#" href="https://iridakos.com/about/" property="cc:attributionName" rel="cc:attributionURL" class="">Lazarus Lazaridis</a> is licensed under a <a class="" rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.
        </div>

        <div>
          <a class="" rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="/assets/images/license.png" /></a>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="my-4">
          <a class="btn btn-light btn-sm mr-1" href="https://www.github.com/iridakos/"><i class="fa fa-github" aria-hidden="true"></i> GitHub</a>
          <a class="btn btn-light btn-sm mr-1" href="https://www.twitter.com/lazaru_s/"><i class="fa fa-twitter" aria-hidden="true"></i> Twitter</a>
          <a class="btn btn-light btn-sm mr-1" href="https://www.linkedin.com/in/iridakos/"><i class="fa fa-linkedin" aria-hidden="true"></i> LinkedIn</a>
        </div>
      </div>
    </div>
  </div>
</footer>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="/assets/javascripts/bootstrap.min.js?1588012267219694436" type="text/javascript"></script>
<script src="/assets/javascripts/docout.js?1588012267219694436" type="text/javascript"></script>
<script src="/assets/javascripts/iridakos.js?1588012267219694436" type="text/javascript"></script>
<script src="/assets/javascripts/search.js?1588012267219694436" type="text/javascript"></script>




  </body>
</html>
